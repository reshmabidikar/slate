# Subscription

A `Subscription` in Kill Bill entitles a customer to the use of a product or service for a period of time in exchange for a specified payment. Every subscription belongs to a `Bundle` that is associated with a given customer `Account`.

Subscriptions are created by specifying a `Plan` from the catalog, and an effective date on which to start. The Plan identifies the `Product` subscribed along with the terms of service and of billing. These attributes are used by the system to drive the generation of invoices. Kill Bill offers two parallel views of the subscription: one to track the entitlement, i.e the service associated with the subscription, and one to track the billing. These views address the following questions:

* Given a date, how much should we invoice ?
* Given a date, is the service available to the customer? 

For most use cases, those two views are one and the same; the customer gets invoiced for what she consumes.

Please refer to our [subscription manual](http://docs.killbill.io/latest/userguide_subscription.html) for more details.

## Subscription Resource

The `Subscription` resource represents a subscription. The attributes contained in the subscription resource are the following:

| Name | Type | Generated by | Description |
| ---- | -----| -------- | ------------ |
| **accountId** | string | system | UUID for the account |
| **bundleId** | string | system | UUID for the bundle |
| **subscriptionId** | string | system | UUID for this subscription |
| **externalKey** | string | user | Optional external key for the subscription |
| **bundleExternalKey** | string | user | Optional external key for the bundle |
| **startDate** | date | user | Datetime the service (entitlement) starts |
| **productName** | string | user | Name of the product subscribed (from catalog) |
| **productCategory** |string | user | Product catgory (see notes below) |
| **billingPeriod** | string | user | Billing period (see notes below) |
| **phaseType** | string | user | Type of the current plan phase (see notes below) |
| **priceList** | string | user | Name of the current price list (from catalog) |
| **planName** | string | user | Name of the current plan (from catalog) |
| **state** | string | system | Current state of the subscription (see notes below) |
| **sourceType** | string | system | Kind of subscription (see notes below) |
| **cancelledDate** | date | user | Datetime when the service stopped, or will stop |
| **chargedThroughDate** | date | system | Date up to which the subscription has been invoiced (see notes below) |
| **billingStartDate** | date | user | Datetime on which the system starts invoicing |
| **billingEndDate** | date | user | Datetime on which the system ends invoicing |
| **billCycleDayLocal** | integer | user or system | Day of the month on which invoices are generated, if applicable (see notes below) |
| **events** | list | system | list of subscription events tracking what happened (see notes below) |
| **prices** | list | user | list of prices, one for each phase in the plan |
| **priceOverrides** | list | user | list of prices if this subscription has price overrides (see notes below) |
| **quantity** | integer | user | quantity of subscriptions (see notes below) |

**productCategory**: possible values are BASE, ADD_ON, or STANDALONE

**billingPeriod**: possible values are DAILY, WEEKLY, BIWEEKLY, THIRTY_DAYS, THIRTY_ONE_DAYS, SIXTY_DAYS, NINETY_DAYS, MONTHLY, BIMESTRIAL (bimonthly), QUARTERLY, TRIANNUAL, BIANNUAL, ANNUAL, SESQUIENNIAL, BIENNIAL, TRIENNIAL, or NO_BILLING_PERIOD

**phaseType**: possible values are: TRIAL, DISCOUNT, FIXEDTERM, or EVERGREEN

**state**: possible values are:

* `PENDING`: The subscription is not yet created.
* `ACTIVE`: The subscription is currently active.
* `BLOCKED`: The subscription is currently paused.
* `CANCELLED`: The subscription has been cancelled.
* `EXPIRED`: The subscription has expired. This state is applicable only for subscriptions with a `FIXEDTERM` phase.

**sourceType**: possible values are NATIVE, MIGRATED, or TRANSFERRED 


**`chargedThroughDate`**: The date up to which the entitlement for this subscription has been invoiced. For `IN_ADVANCE` billing mode, this date will often be in the future; for `IN_ARREAR`, this date will often be in the past. For example,

1. A subscription is billed each month, on the 15th, in advance. If we check on May 31, the `chargedThroughDate` will be June 15th, 15 days ahead. If the subscription is ended on May 31, a prorated credit will need to be issued.

2. A subscription is billed quarterly, in arrears, on the 10th of Feb., May, Aug., and Nov. If we check on Jul. 20, the `chargedThroughDate` will be May 10, over 2 months earlier. If the subscription is cancelled on Jul. 20, an additional invoice will need to be issued.

These use cases assume that invoicing is up to date. If AUTO_INVOICING_OFF is set, invoicing relies on a manual process and may be late. In that situation the first use case may require a smaller credit or none at all, while the second case will have a larger amount to be billed to close out the subscription.

**`billCycleDayLocal`**: this value is either the overridden subscription billCycleDay (in case of BCD change) or the value at the subscription, bundle or account level (depending on the catalog [billing alignments](http://docs.killbill.io/latest/userguide_subscription.html#_billing_alignment_rules)). For `ACCOUNT` billing alignments, if the account level billCycleDay hasn't been set yet, the value returned would be null.

**`Events`**: possible event types are START_ENTITLEMENT, START_BILLING, PAUSE_ENTITLEMENT, PAUSE_BILLING, RESUME_ENTITLEMENT, RESUME_BILLING, PHASE, CHANGE, STOP_ENTITLEMENT, STOP_BILLING, SERVICE_STATE_CHANGE


**`priceOverrides`**:  List of overridden prices for specific plan phases. Can be specified to override the fixed/recurring price in the catalog for a particular phase. For example, suppose you are creating a subscription corresponding to a plan that has an `EVERGREEN` phase with a recurring price of `$100`. You can specify an overridden price of `200` while creating the subscription by specifying a `priceOverrides` object as follows:


```shell
"priceOverrides": [
        {
            "planName": "shotgun-monthly",
            "phaseType": "DISCOUNT",
            "fixedPrice": null,
            "recurringPrice": 150.00,
            "usagePrices": []
        }
```

**quantity**: An integer value that specifies the quantity of subscription. The default value is 1. The corresponding invoice is generated as per the quantity. So if `price=$20/mo`, `quantity=$2` => `invoiceItem recurring amount=$40`.

## Subscriptions

These endpoints support the basic CRUD operations on Subscriptions.

### Create a subscription

This API creates a base product subscription. It also creates a bundle to contain the subscription. See [Bundle](https://killbill.github.io/slate/#bundle) for further information.

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/subscriptions`

> Example Request:

```shell

# With planName
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '{ 
            "accountId": "581d86fc-7cfc-46f2-b6d4-4dbc1d98beb3",
            "externalKey": "somethingSpecial",
            "planName": "super-monthly"
        }' \
    "http://127.0.0.1:8080/1.0/kb/subscriptions" 
    
# With productName, productCategory and billingPeriod
    
    curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '{ 
          "accountId": "59afd9fe-e98d-4fb3-b5bf-21d4a2b036cd",
			"externalKey": "somethingSpecial", 
			"productName": "Test", 
			"productCategory": "BASE",  
			"billingPeriod": "MONTHLY",
			"priceList": "DEFAULT"
        }' \
    "http://127.0.0.1:8080/1.0/kb/subscriptions" 	
    
# With priceOverrides
    
    curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '{ 
            "accountId": "187f9270-7aa0-4db5-81f7-857e8e59fd9a",
            "planName": "shotgun-monthly",
			 "prices": [
        {
            "planName": "shotgun-monthly",
            "phaseType": "DISCOUNT",
            "fixedPrice": 150.00,
            "recurringPrice": null,
            "usagePrices": []
        },
        {
            "planName": "shotgun-monthly",
            "phaseType": "EVERGREEN",
            "fixedPrice": null,
            "recurringPrice": 400.00,
            "usagePrices": []
        }		
    ]
        }' \
    "http://127.0.0.1:8080/1.0/kb/subscriptions" 
    
# With Datetime

curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '{ 
            "accountId": "325fbe1c-7c35-4d96-a4e5-2cbaabe218c6",
            "planName": "pistol-monthly-notrial"
        }' \
    "http://127.0.0.1:8080/1.0/kb/subscriptions?billingDate=2023-02-07T11:15&entitlementDate=2023-02-07T11:15" 
   
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID accountId = UUID.fromString("905a0636-ab63-40c0-acd4-b461b6808b5d");

Subscription input = new Subscription();
input.setAccountId(accountId);
input.setExternalKey("somethingSpecial");
input.setPlanName("shotgun-monthly");

LocalDate entitlementDate = null;
LocalDate billingDate = null;
Boolean renameKeyIfExistsAndUnused = null; 
Boolean migrated = null;
Boolean skipResponse = false;
Boolean callCompletion = true;
long DEFAULT_WAIT_COMPLETION_TIMEOUT_SEC = 10;
Map<String, String> NULL_PLUGIN_PROPERTIES = null;

Subscription subscription = subscriptionApi.createSubscription(input, 
                                                               entitlementDate, 
                                                               billingDate, 
                                                               renameKeyIfExistsAndUnused, 
                                                               migrated,
                                                               skipResponse,  
                                                               callCompletion, 
                                                               DEFAULT_WAIT_COMPLETION_TIMEOUT_SEC, 
                                                               NULL_PLUGIN_PROPERTIES, 
                                                               requestOptions);
```

```ruby
subscription              = KillBillClient::Model::Subscription.new
subscription.account_id   = "e1826665-4524-4d57-81b5-a5eb11146f3f"
subscription.plan_name    = "basic-monthly-in-advance"

requested_date  = nil
call_completion = nil 

subscription.create(user, 
                    reason, 
                    comment, 
                    requested_date, 
                    call_completion, 
                    options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
account_id = 'e1826665-4524-4d57-81b5-a5eb11146f3f'
body = Subscription(account_id=account_id, plan_name='standard-monthly')

subscriptionApi.create_subscription(body,
                                    created_by,
                                    api_key,
                                    api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712
< Content-Type: application/json
< Content-Length: 0
```

```java
class Subscription {
    org.killbill.billing.client.model.gen.Subscription@49563466
    accountId: e8cd6795-0da1-4848-831f-51977eed42b1
    bundleId: eac6eecf-2060-434a-b472-170f80a7591c
    subscriptionId: a74081ee-d7bb-4387-a1df-34e962e37699
    externalKey: somethingSpecial
    bundleExternalKey: somethingAlsoSpecial
    startDate: 2012-04-25
    productName: Shotgun
    productCategory: BASE
    billingPeriod: MONTHLY
    phaseType: TRIAL
    priceList: DEFAULT
    planName: shotgun-monthly
    state: ACTIVE
    sourceType: NATIVE
    cancelledDate: null
    chargedThroughDate: null
    billingStartDate: 2012-04-25
    billingEndDate: null
    billCycleDayLocal: 25
    events: [class EventSubscription {
        org.killbill.billing.client.model.gen.EventSubscription@37b70727
        eventId: 9ef798a3-95f6-41ac-9b86-00c9385c155f
        billingPeriod: MONTHLY
        effectiveDate: 2012-04-25
        plan: shotgun-monthly
        product: Shotgun
        priceList: DEFAULT
        eventType: START_ENTITLEMENT
        isBlockedBilling: false
        isBlockedEntitlement: false
        serviceName: entitlement-service
        serviceStateName: ENT_STARTED
        phase: shotgun-monthly-trial
        auditLogs: []
    }, class EventSubscription {
        org.killbill.billing.client.model.gen.EventSubscription@410923f5
        eventId: 65ec07fa-61c7-4f05-bd6f-82cea23cf06a
        billingPeriod: MONTHLY
        effectiveDate: 2012-04-25
        plan: shotgun-monthly
        product: Shotgun
        priceList: DEFAULT
        eventType: START_BILLING
        isBlockedBilling: false
        isBlockedEntitlement: false
        serviceName: billing-service
        serviceStateName: START_BILLING
        phase: shotgun-monthly-trial
        auditLogs: []
    }, class EventSubscription {
        org.killbill.billing.client.model.gen.EventSubscription@cac84db3
        eventId: 88f77a50-edca-4cc3-b234-5d70c457128c
        billingPeriod: MONTHLY
        effectiveDate: 2012-05-25
        plan: shotgun-monthly
        product: Shotgun
        priceList: DEFAULT
        eventType: PHASE
        isBlockedBilling: false
        isBlockedEntitlement: false
        serviceName: entitlement+billing-service
        serviceStateName: PHASE
        phase: shotgun-monthly-evergreen
        auditLogs: []
    }]
    priceOverrides: null
    prices: [class PhasePrice {
        planName: shotgun-monthly
        phaseName: shotgun-monthly-trial
        phaseType: TRIAL
        fixedPrice: 0
        recurringPrice: null
        usagePrices: []
    }, class PhasePrice {
        planName: shotgun-monthly
        phaseName: shotgun-monthly-evergreen
        phaseType: EVERGREEN
        fixedPrice: null
        recurringPrice: 249.95
        usagePrices: []
    }]
    auditLogs: []
}
```
```ruby
{
   "accountId":"e1826665-4524-4d57-81b5-a5eb11146f3f",
   "bundleId":"f3dea847-1567-467a-8373-838dfdcf6afc",
   "subscriptionId":"ee508b5b-46b8-42a7-8988-16c0470de4ae",
   "externalKey":"f3dea847-1567-467a-8373-838dfdcf6afc",
   "bundleExternalKey":"addea847-1467-167a-1373-988dfdcf7acc",
   "startDate":"2013-08-01",
   "productName":"Basic",
   "productCategory":"BASE",
   "billingPeriod":"MONTHLY",
   "phaseType":"EVERGREEN",
   "priceList":"DEFAULT",
   "planName":"basic-monthly-in-advance",
   "state":"ACTIVE",
   "sourceType":"NATIVE",
   "chargedThroughDate":"2013-09-01",
   "billingStartDate":"2013-08-01",
   "billCycleDayLocal":1,
   "events":[
      {
         "eventId":"341fc529-612b-4bb9-b8d7-ee4a9115f577",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-01",
         "plan":"basic-monthly-in-advance",
         "product":"Basic",
         "priceList":"DEFAULT",
         "eventType":"START_ENTITLEMENT",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"entitlement-service",
         "serviceStateName":"ENT_STARTED",
         "phase":"basic-monthly-in-advance-evergreen",
         "auditLogs":[]
      },
      {
         "eventId":"caa54161-c001-44a0-9ff0-80be59989380",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-01",
         "plan":"basic-monthly-in-advance",
         "product":"Basic",
         "priceList":"DEFAULT",
         "eventType":"START_BILLING",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"billing-service",
         "serviceStateName":"START_BILLING",
         "phase":"basic-monthly-in-advance-evergreen",
         "auditLogs":[]
      }
   ],
   "prices":[
      {
         "planName":"basic-monthly-in-advance",
         "phaseName":"basic-monthly-in-advance-trial",
         "phaseType":"TRIAL",
         "fixedPrice":0,
         "recurringPrice":null,
         "usagePrices":[]
      },
      {
         "planName":"basic-monthly-in-advance",
         "phaseName":"basic-monthly-in-advance-evergreen",
         "phaseType":"EVERGREEN",
         "fixedPrice":null,
         "recurringPrice":500.0,
         "usagePrices":[]
      }
   ],
   "auditLogs":[]
}
```
```python
no content
```

**Request Body**

A subscription resource object specifying `accountId` and either the `planName` or a combination of `productName`, `productCategory`,`billingPeriod` and `priceList`. 

It can also include the following optional fields:

* `phaseType` - Target phase type. Specifying this field causes the subscription to start with this phase.
* `externalKey` - External key corresponding to the subscription.
* `billCycleDayLocal` - Per-subscription BCD. Specifying this value allows realigning the billing with the specified date. 
* `bundleId` - Id of the bundle in which to create this subscription. Can be specified only while invoking this method for an addon subscription.


**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | ---- | -------- | ------- | ----------- |
| **entitlementDate** | string | no | immediately | Date/DateTime at which the entitlement (service) starts in `yyyy-mm-dd`/`yyyy-mm-ddThh:mm` format.|
| **billingDate** | string | no | immediately | Date/DateTime at which the entitlement (service) starts in `yyyy-mm-dd`/`yyyy-mm-ddThh:mm` format.|
| **renameKeyIfExistsAndUnused** | boolean | no | true | If true, rename external key if it exists and is unused |
| **migrated** | boolean | no | false | If true, subscription is migrated |
| **callCompletion** | boolean | no | false | see below |
| **callTimeoutSec** | long | no | unlimited? | Timeout in seconds (see below) |

Creating a subscription often triggers the creation of an invoice, and associated with this there is often a payment (against the invoice). If **callCompletion** is true, the call to this API will be delayed until the invoice is created and/or the payment is processed. However, the maximum delay in seconds will be given by **callTimeoutSec**.

**Other Notes:**

* Specifying the `startDate`/`billingStartDate` as part of the request body has no effect, these dates need to be passed as query parameters (`entitlementDate`/`billingDate`). 
* The `entitlementDate` drives the subscription state. So, if a subscription is created with a future `entitlementDate`, its state remains `PENDING` until the date is reached after which it becomes `ACTIVE`.


**Response**

If successful, returns a status code of 201 and an empty body. In addition, a `Location` parameter is returned in the header which contains the new subscription id.

### Create a subscription with addon products

This API creates an addon product subscription. The bundle for the base subscription must be specified.


**HTTP Request**

`POST http://127.0.0.1:8080/1.0/kb/subscriptions/createSubscriptionWithAddOns`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '[
          {
            "accountId": "581d86fc-7cfc-46f2-b6d4-4dbc1d98beb3",
            "externalKey": "something",
            "bundleExternalKey": "somethingAlso",
            "productName": "Sports",
            "productCategory": "BASE",
            "billingPeriod": "MONTHLY",
            "priceList": "DEFAULT"
        },
        {
          "accountId": "581d86fc-7cfc-46f2-b6d4-4dbc1d98beb3",
          "productName": "OilSlick",
          "productCategory": "ADD_ON",
          "billingPeriod": "MONTHLY",
          "priceList": "DEFAULT"
        }
        ]' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/createSubscriptionWithAddOns' 
    
OR

curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '[
          
        {
          "accountId": "1f635c3d-fc24-4fa8-81e0-ab646882807a",
          "planName": "remotecontrol-monthly",
          "bundleId":"b4709feb-bd14-455a-bbb4-57a758498791"
        }
        ]' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/createSubscriptionWithAddOns' 	
    
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID accountId = UUID.fromString("abfba40d-d2dd-47f0-94f2-8ea3e6bc8794");

Subscription base = new Subscription();
base.setAccountId(accountId);
base.setExternalKey("base");
base.setProductName("Shotgun");
base.setProductCategory(ProductCategory.BASE);
base.setBillingPeriod(BillingPeriod.MONTHLY);
base.setPriceList("DEFAULT");

final Subscription addOn1 = new Subscription();
addOn1.setAccountId(accountId);
addOn1.setProductName("Telescopic-Scope");
addOn1.setProductCategory(ProductCategory.ADD_ON);
addOn1.setBillingPeriod(BillingPeriod.MONTHLY);
addOn1.setPriceList("DEFAULT");

final Subscription addOn2 = new Subscription();
addOn2.setAccountId(accountId);
addOn2.setProductName("Laser-Scope");
addOn2.setProductCategory(ProductCategory.ADD_ON);
addOn2.setBillingPeriod(BillingPeriod.MONTHLY);
addOn2.setPriceList("DEFAULT");

final Subscriptions subscriptions = new Subscriptions();
subscriptions.add(base);
subscriptions.add(addOn1);
subscriptions.add(addOn2);

LocalDate entitlementDate = null;
LocalDate billingDate = null;
Boolean migrated = null;
Boolean skipResponse = false;
Boolean renameKeyIfExistsAndUnused = null;
Boolean callCompletion = true;
long DEFAULT_WAIT_COMPLETION_TIMEOUT_SEC = 10;
Map<String, String> NULL_PLUGIN_PROPERTIES = null;

final Bundle bundle = subscriptionApi.createSubscriptionWithAddOns(subscriptions, 
                                                                   entitlementDate, 
                                                                   billingDate, 
                                                                   migrated, 
                                                                   skipResponse,
                                                                   renameKeyIfExistsAndUnused, 
                                                                   callCompletion, 
                                                                   DEFAULT_WAIT_COMPLETION_TIMEOUT_SEC, 
                                                                   NULL_PLUGIN_PROPERTIES, 
                                                                   requestOptions);
```

```ruby
entitlement = [
                 {
                    "baseEntitlementAndAddOns":[
                       {
                          "accountId":"16cd9eb8-bb5d-4183-b8e0-c1d6f78dc836",
                          "externalKey":"1-16cd9eb8-bb5d-4183-b8e0-c1d6f78dc836-827963",
                          "productCategory":"BASE",
                          "planName":"sports-monthly"
                       }
                    ]
                 }
              ]
requested_date = nil
entitlement_date = nil
billing_date = nil
migrated = false
call_completion_sec = 3

subscription = KillBillClient::Model::Subscription.new
subscription.create_entitlement_with_add_on(entitlement,
                                            requested_date,
                                            entitlement_date, 
                                            billing_date,
                                            migrated, 
                                            call_completion_sec,                                            
                                            user, 
                                            reason, 
                                            comment, 
                                            options)                                         
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
account_id = '16cd9eb8-bb5d-4183-b8e0-c1d6f78dc836'
subscription_a = Subscription(account_id=account_id,
                              product_category='BASE',
                              plan_name='sports-monthly')

subscription_b = Subscription(account_id=account_id,
                              product_category='ADD_ON',
                              plan_name='super-monthly')

body = [subscription_a, subscription_b]

subscriptionApi.create_subscription_with_add_ons(body,
                                                 created_by,
                                                 api_key,
                                                 api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://127.0.0.1:8080/1.0/kb/accounts/886adb60-be70-40c8-b97d-1f8ecbc30a64/bundles?bundlesFilter=cbcc7642-1aa5-4609-b89d-5356d05819be
< Content-Type: application/json
< Content-Length: 0
```

```java
class Bundle {
    org.killbill.billing.client.model.gen.Bundle@ddd846f9
    accountId: abfba40d-d2dd-47f0-94f2-8ea3e6bc8794
    bundleId: 83f3a7b5-63c9-4b06-a1f5-7140fec67558
    externalKey: base
    subscriptions: [class Subscription {
        org.killbill.billing.client.model.gen.Subscription@bb1bf160
        accountId: abfba40d-d2dd-47f0-94f2-8ea3e6bc8794
        bundleId: 83f3a7b5-63c9-4b06-a1f5-7140fec67558
        subscriptionId: 6fcf439b-4198-4963-8f0e-7e3054525a24
        externalKey: base
        startDate: 2012-04-25
        productName: Shotgun
        productCategory: BASE
        billingPeriod: MONTHLY
        phaseType: TRIAL
        priceList: DEFAULT
        planName: shotgun-monthly
        state: ACTIVE
        sourceType: NATIVE
        cancelledDate: null
        chargedThroughDate: 2012-04-25
        billingStartDate: 2012-04-25
        billingEndDate: null
        billCycleDayLocal: 25
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@a6789138
            eventId: fb7d653a-cadb-46f6-a04f-dbe7043385ed
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: shotgun-monthly
            product: Shotgun
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: shotgun-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@b4b456ed
            eventId: b5c00fdf-6ce4-46ad-b996-5513146d8acd
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: shotgun-monthly
            product: Shotgun
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: shotgun-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@fb1cc392
            eventId: edd91628-323d-4a3a-b07e-bef09a2623a2
            billingPeriod: MONTHLY
            effectiveDate: 2012-05-25
            plan: shotgun-monthly
            product: Shotgun
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: shotgun-monthly-evergreen
            auditLogs: []
        }]
        priceOverrides: null
        prices: [class PhasePrice {
            planName: shotgun-monthly
            phaseName: shotgun-monthly-trial
            phaseType: TRIAL
            fixedPrice: 0
            recurringPrice: null
            usagePrices: []
        }, class PhasePrice {
            planName: shotgun-monthly
            phaseName: shotgun-monthly-evergreen
            phaseType: EVERGREEN
            fixedPrice: null
            recurringPrice: 249.95
            usagePrices: []
        }]
        auditLogs: []
    }, class Subscription {
        org.killbill.billing.client.model.gen.Subscription@37a59f88
        accountId: abfba40d-d2dd-47f0-94f2-8ea3e6bc8794
        bundleId: 83f3a7b5-63c9-4b06-a1f5-7140fec67558
        subscriptionId: a490a1c8-ca78-4cbd-bb5a-1ce214cc2f23
        externalKey: base
        startDate: 2012-04-25
        productName: Telescopic-Scope
        productCategory: ADD_ON
        billingPeriod: MONTHLY
        phaseType: DISCOUNT
        priceList: DEFAULT
        planName: telescopic-scope-monthly
        state: ACTIVE
        sourceType: NATIVE
        cancelledDate: null
        chargedThroughDate: 2012-05-25
        billingStartDate: 2012-04-25
        billingEndDate: null
        billCycleDayLocal: 25
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@9c41861a
            eventId: 6be47e8c-0ff6-45ee-9b79-7a91c6867e6c
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: telescopic-scope-monthly
            product: Telescopic-Scope
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: telescopic-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@a386d43d
            eventId: 0c6b12cb-9390-4d64-b98a-93a8c9a6b67b
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: telescopic-scope-monthly
            product: Telescopic-Scope
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: telescopic-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@429a9148
            eventId: 27ce7282-c84c-495a-a7fc-be393cfcf3a7
            billingPeriod: MONTHLY
            effectiveDate: 2012-05-25
            plan: telescopic-scope-monthly
            product: Telescopic-Scope
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: telescopic-scope-monthly-evergreen
            auditLogs: []
        }]
        priceOverrides: null
        prices: [class PhasePrice {
            planName: telescopic-scope-monthly
            phaseName: telescopic-scope-monthly-trial
            phaseType: TRIAL
            fixedPrice: 0
            recurringPrice: null
            usagePrices: []
        }, class PhasePrice {
            planName: telescopic-scope-monthly
            phaseName: telescopic-scope-monthly-evergreen
            phaseType: EVERGREEN
            fixedPrice: null
            recurringPrice: 249.95
            usagePrices: []
        }]
        auditLogs: []
    }, class Subscription {
        org.killbill.billing.client.model.gen.Subscription@10da5c43
        accountId: abfba40d-d2dd-47f0-94f2-8ea3e6bc8794
        bundleId: 83f3a7b5-63c9-4b06-a1f5-7140fec67558
        subscriptionId: 8f957bfa-61da-45ca-ae4c-ed34b045f18e
        externalKey: base
        startDate: 2012-04-25
        productName: Laser-Scope
        productCategory: ADD_ON
        billingPeriod: MONTHLY
        phaseType: DISCOUNT
        priceList: DEFAULT
        planName: laser-scope-monthly
        state: ACTIVE
        sourceType: NATIVE
        cancelledDate: null
        chargedThroughDate: 2012-05-25
        billingStartDate: 2012-04-25
        billingEndDate: null
        billCycleDayLocal: 25
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@6615c622
            eventId: eb05b9d5-a055-426c-8411-7fd9b4728d45
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: laser-scope-monthly
            product: Laser-Scope
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: laser-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@41ddb948
            eventId: 6fbe3e71-7e3b-4c3b-8bdd-27c8dc71e044
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: laser-scope-monthly
            product: Laser-Scope
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: laser-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@182c6fd0
            eventId: bec40e45-6ffb-49f3-831d-722f19d8ed09
            billingPeriod: MONTHLY
            effectiveDate: 2012-05-25
            plan: laser-scope-monthly
            product: Laser-Scope
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: laser-scope-monthly-evergreen
            auditLogs: []
        }]
        priceOverrides: null
        prices: [class PhasePrice {
            planName: laser-scope-monthly
            phaseName: laser-scope-monthly-trial
            phaseType: TRIAL
            fixedPrice: 0
            recurringPrice: null
            usagePrices: []
        }, class PhasePrice {
            planName: laser-scope-monthly
            phaseName: laser-scope-monthly-evergreen
            phaseType: EVERGREEN
            fixedPrice: null
            recurringPrice: 249.95
            usagePrices: []
        }]
        auditLogs: []
    }]
    timeline: class BundleTimeline {
        org.killbill.billing.client.model.gen.BundleTimeline@8a202296
        accountId: abfba40d-d2dd-47f0-94f2-8ea3e6bc8794
        bundleId: 83f3a7b5-63c9-4b06-a1f5-7140fec67558
        externalKey: base
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@5aa4f7e9
            eventId: eb05b9d5-a055-426c-8411-7fd9b4728d45
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: laser-scope-monthly
            product: Laser-Scope
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: laser-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@1df149f3
            eventId: 6be47e8c-0ff6-45ee-9b79-7a91c6867e6c
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: laser-scope-monthly
            product: Laser-Scope
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: laser-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@68a2bc3b
            eventId: fb7d653a-cadb-46f6-a04f-dbe7043385ed
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: laser-scope-monthly
            product: Laser-Scope
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: laser-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@787b414d
            eventId: 6fbe3e71-7e3b-4c3b-8bdd-27c8dc71e044
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: laser-scope-monthly
            product: Laser-Scope
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: laser-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@5ba02249
            eventId: 0c6b12cb-9390-4d64-b98a-93a8c9a6b67b
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: telescopic-scope-monthly
            product: Telescopic-Scope
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: telescopic-scope-monthly-discount
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@d45c4b96
            eventId: b5c00fdf-6ce4-46ad-b996-5513146d8acd
            billingPeriod: MONTHLY
            effectiveDate: 2012-04-25
            plan: shotgun-monthly
            product: Shotgun
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: shotgun-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@2360e010
            eventId: bec40e45-6ffb-49f3-831d-722f19d8ed09
            billingPeriod: MONTHLY
            effectiveDate: 2012-05-25
            plan: laser-scope-monthly
            product: Laser-Scope
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: laser-scope-monthly-evergreen
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@49d428fe
            eventId: 27ce7282-c84c-495a-a7fc-be393cfcf3a7
            billingPeriod: MONTHLY
            effectiveDate: 2012-05-25
            plan: telescopic-scope-monthly
            product: Telescopic-Scope
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: telescopic-scope-monthly-evergreen
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@aebff2be
            eventId: edd91628-323d-4a3a-b07e-bef09a2623a2
            billingPeriod: MONTHLY
            effectiveDate: 2012-05-25
            plan: shotgun-monthly
            product: Shotgun
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: shotgun-monthly-evergreen
            auditLogs: []
        }]
        auditLogs: []
    }
    auditLogs: []
}
```
```ruby
no content
```
```python
no content
```

**Request Body**

A subscription resource object corresponding to the base subscription and zero or more subscription resource objects corresponding to add-on subscriptions need to be specified. Alternatively, only a list of add-on subscription resource objects may be specified along with the base subscription bundle id. Each subscription resource object needs to include `accountId` and either the `planName` or a combination of `productName`, `productCategory`,`billingPeriod` and `priceList`.

In addition, each subscription resource can also include the following optional fields:

* `phaseType` - Target phase type. Specifying this field causes the subscription to start with this phase.
* `externalKey` - External key corresponding to the subscription.
* `billCycleDayLocal` - Per-subscription BCD. Specifying this value allows realigning the billing with the specified date. 
* `bundleId` - Id of the bundle in which to create this subscription. Can be specified only with an add-on subscription resource.

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | ---- | -------- | ------- | ----------- |
| **entitlementDate** | string | no | immediately | Date at which the entitlement (sevice) starts in `yyyy-mm-dd` format. If specified, applies both to base and add-on products. |
| **billingDate** | string | no | immediately | Date at which the billing starts in `yyyy-mm-dd` format. If specified, applies both to base and add-on products. |
| **renameKeyIfExistsAndUnused** | boolean | no | true | If true, rename external key if it exists and is unused |
| **migrated** | boolean | no | false | If true, subscription is migrated |
| **callCompletion** | boolean | no | false | see below |
| **callTimeoutSec** | long | no | unlimited? | Timeout in seconds (see below) |

Creating a subscription often triggers the creation of an invoice, and associated with this there is often a payment (against the invoice). If **callCompletion** is true, the call to this API will be delayed until the invoice is created and/or the payment is processed. However, the maximum delay in seconds will be given by **callTimeoutSec**.

**Response**

If successful, returns a status code of 201 and an empty body. In addition, a `Location` parameter is returned in the header which contains the new subscription id.



### Create multiple subscriptions with addon products

This API creates multiple subscriptions with addon products. The bundle for the base subscription must be specified.


**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/subscriptions/createSubscriptionsWithAddOns`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '[
          {
            "baseEntitlementAndAddOns": [
              {
                "accountId": "886adb60-be70-40c8-b97d-1f8ecbc30a64",
                "externalKey": "base",
                "productName": "Sports",
                "productCategory": "BASE",
                "billingPeriod": "MONTHLY",
                "priceList": "DEFAULT"
              },
              {
                "accountId": "886adb60-be70-40c8-b97d-1f8ecbc30a64",
                "productName": "OilSlick",
                "productCategory": "ADD_ON",
                "billingPeriod": "MONTHLY",
                "priceList": "DEFAULT"
              }
            ]
          },
		   {
            "baseEntitlementAndAddOns": [
              {
                "accountId": "59afd9fe-e98d-4fb3-b5bf-21d4a2b036cd",
                "externalKey": "createSubscriptionsWithAddOns3",
                "productName": "Test",
                "productCategory": "BASE",
                "billingPeriod": "MONTHLY",
                "priceList": "DEFAULT"
              },
              {
                "accountId": "59afd9fe-e98d-4fb3-b5bf-21d4a2b036cd",
                "productName": "TestAO",
                "productCategory": "ADD_ON",
                "billingPeriod": "MONTHLY",
                "priceList": "DEFAULT"
              }
            ]
          }
        ]' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/createSubscriptionsWithAddOns' 
    
OR 

curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '[
          {
            "baseEntitlementAndAddOns": [
              {
                "accountId": "1f635c3d-fc24-4fa8-81e0-ab646882807a",
                "planName": "remotecontrol-monthly",  
                "bundleId":"a8b4022c-e38c-4336-ad2f-ee15c5e18d12"
              }
            ]
          },
		  {
            "baseEntitlementAndAddOns": [
              
              {
                "accountId": "1f635c3d-fc24-4fa8-81e0-ab646882807a",
                "planName": "remotecontrol-monthly",
                "bundleId":"06892885-c276-4cf9-8311-ef0b8a2e364b"
              }
            ]
          }
        ]' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/createSubscriptionsWithAddOns' 
    
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID accountId = UUID.fromString("a3087bfb-eb81-466d-afeb-6501c30f8f85");

Subscription base = new Subscription();
base.setAccountId(accountId);
base.setPlanName("test-monthly");

final Subscription addOn1 = new Subscription();
addOn1.setAccountId(accountId);
addOn1.setPlanName("testao-monthly");

final Subscriptions subscriptions = new Subscriptions();
subscriptions.add(base);
subscriptions.add(addOn1);

BulkSubscriptionsBundle bulkSubscriptionsBundle = new BulkSubscriptionsBundle();
bulkSubscriptionsBundle.setBaseEntitlementAndAddOns(subscriptions);
		
Subscription base2 = new Subscription();
base2.setAccountId(accountId);
base2.setPlanName("product1-monthly");
		
Subscription base2addOn1 = new Subscription();
base2addOn1.setAccountId(accountId);
base2addOn1.setPlanName("product1-ao-monthly");
base2addOn1.setBillCycleDayLocal(18);
		
Subscriptions subscriptions2 = new Subscriptions();
subscriptions2.add(base2);
subscriptions2.add(base2addOn1);
		
BulkSubscriptionsBundle bulkSubscriptionsBundle2 = new BulkSubscriptionsBundle();
bulkSubscriptionsBundle2.setBaseEntitlementAndAddOns(subscriptions2);
		
BulkSubscriptionsBundles bulkSubscriptionsBundles = new BulkSubscriptionsBundles();
bulkSubscriptionsBundles.add(bulkSubscriptionsBundle);
bulkSubscriptionsBundles.add(bulkSubscriptionsBundle2);

LocalDate entitlementDate = null;
LocalDate billingDate = null;
Boolean renameKeyIfExistsAndUnused = false;
Boolean migrated = false;
Boolean skipResponse = false;
Boolean callCompletion = true;
long DEFAULT_WAIT_COMPLETION_TIMEOUT_SEC = 10;
Map<String, String> NULL_PLUGIN_PROPERTIES = null;

Bundles bundles = subscriptionApi.createSubscriptionsWithAddOns(bulkSubscriptionsBundles, 
		                                                         entitlementDate, 
		                                                         billingDate, 
		                                                         renameKeyIfExistsAndUnused, 
		                                                         migrated, 
		                                                         skipResponse, 
		                                                         callCompletion, 
                                                                DEFAULT_WAIT_COMPLETION_TIMEOUT_SEC, NULL_PLUGIN_PROPERTIES,                                                               requestOptions);
```

```ruby
bulk_subscription_list = [
                            {
                               "baseEntitlementAndAddOns":[
                                  {
                                     "accountId":"16cd9eb8-bb5d-4183-b8e0-c1d6f78dc836",
                                     "externalKey":"1-16cd9eb8-bb5d-4183-b8e0-c1d6f78dc836-827963",
                                     "productCategory":"BASE",
                                     "planName":"sports-monthly"
                                  }
                               ]
                            },
                            {
                               "baseEntitlementAndAddOns":[
                                  {
                                     "accountId":"16cd9eb8-bb5d-4183-b8e0-c1d6f78dc836",
                                     "externalKey":"2-16cd9eb8-bb5d-4183-b8e0-c1d6f78dc836-717751",
                                     "productCategory":"ADD_ON",
                                     "planName":"super-monthly"
                                  }
                               ]
                            }
                         ]
entitlement_date = nil
billing_date = nil
call_completion_sec = nil

KillBillClient::Model::BulkSubscription.create_bulk_subscriptions(bulk_subscription_list, 
                                                                  user, 
                                                                  reason, 
                                                                  comment, 
                                                                  entitlement_date, 
                                                                  billing_date, 
                                                                  call_completion_sec, 
                                                                  options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
account_id = '16cd9eb8-bb5d-4183-b8e0-c1d6f78dc836'
subscription_a = Subscription(account_id=account_id,
                              product_category='BASE',
                              plan_name='sports-monthly')

subscription_b = Subscription(account_id=account_id,
                              product_category='ADD_ON',
                              plan_name='super-monthly')

body = BulkSubscriptionsBundle([subscription_a, subscription_b])

subscriptionApi.create_subscriptions_with_add_ons([body],
                                                  created_by,
                                                  api_key,
                                                  api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://127.0.0.1:8080/1.0/kb/accounts/886adb60-be70-40c8-b97d-1f8ecbc30a64/bundles?bundlesFilter=cbcc7642-1aa5-4609-b89d-5356d05819be
< Content-Type: application/json
< Content-Length: 0
```

```java
class Bundle {
    org.killbill.billing.client.model.gen.Bundle@ccb83609
    accountId: 1d6ef148-3e91-455d-937a-27d8b2f6deff
    bundleId: 18cae774-d466-4a19-b1d3-d64fb6c0bd30
    externalKey: 18cae774-d466-4a19-b1d3-d64fb6c0bd30
    subscriptions: [class Subscription {
        org.killbill.billing.client.model.gen.Subscription@6ab8272b
        accountId: 1d6ef148-3e91-455d-937a-27d8b2f6deff
        bundleId: 18cae774-d466-4a19-b1d3-d64fb6c0bd30
        bundleExternalKey: 18cae774-d466-4a19-b1d3-d64fb6c0bd30
        subscriptionId: 266ff081-db2a-4fd9-b9b4-4a4b85c553df
        externalKey: 266ff081-db2a-4fd9-b9b4-4a4b85c553df
        startDate: 2021-11-29
        productName: Product1
        productCategory: BASE
        billingPeriod: MONTHLY
        phaseType: TRIAL
        priceList: DEFAULT
        planName: product1-monthly
        state: ACTIVE
        sourceType: NATIVE
        cancelledDate: null
        chargedThroughDate: 2021-11-29
        billingStartDate: 2021-11-29
        billingEndDate: null
        billCycleDayLocal: 29
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@9ac9be06
            eventId: 12c85188-f2a8-4590-83af-65c75fc9677b
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: product1-monthly
            product: Product1
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: product1-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@546fe023
            eventId: eadcaf35-673e-4d93-8adf-dfe5ad6422cb
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: product1-monthly
            product: Product1
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: product1-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@37f33629
            eventId: 29a3ccee-f331-48d4-b1c6-be7f03d0d8c5
            billingPeriod: MONTHLY
            effectiveDate: 2021-12-09
            plan: product1-monthly
            product: Product1
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: product1-monthly-evergreen
            auditLogs: []
        }]
        priceOverrides: null
        prices: [class PhasePrice {
            planName: product1-monthly
            phaseName: product1-monthly-trial
            phaseType: TRIAL
            fixedPrice: 0
            recurringPrice: null
            usagePrices: []
        }, class PhasePrice {
            planName: product1-monthly
            phaseName: product1-monthly-evergreen
            phaseType: EVERGREEN
            fixedPrice: null
            recurringPrice: 10
            usagePrices: []
        }]
        auditLogs: []
    }, class Subscription {
        org.killbill.billing.client.model.gen.Subscription@edd6cbe2
        accountId: 1d6ef148-3e91-455d-937a-27d8b2f6deff
        bundleId: 18cae774-d466-4a19-b1d3-d64fb6c0bd30
        bundleExternalKey: 18cae774-d466-4a19-b1d3-d64fb6c0bd30
        subscriptionId: 244d5e5a-71af-4bfc-b7ec-7651f30e7208
        externalKey: 244d5e5a-71af-4bfc-b7ec-7651f30e7208
        startDate: 2021-11-29
        productName: product1-ao
        productCategory: ADD_ON
        billingPeriod: MONTHLY
        phaseType: TRIAL
        priceList: DEFAULT
        planName: product1-ao-monthly
        state: ACTIVE
        sourceType: NATIVE
        cancelledDate: null
        chargedThroughDate: 2021-11-29
        billingStartDate: 2021-11-29
        billingEndDate: null
        billCycleDayLocal: 18
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@13fb439a
            eventId: 8a9c0292-a36d-4428-ac47-c9fe39876d5a
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: product1-ao-monthly
            product: product1-ao
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: product1-ao-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@8553fc75
            eventId: 6c87c127-edef-4762-9804-3cd8638673be
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: product1-ao-monthly
            product: product1-ao
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: product1-ao-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@28e2d33d
            eventId: 13495761-2cf0-46aa-ab80-7586cdaf8a11
            billingPeriod: MONTHLY
            effectiveDate: 2021-12-09
            plan: product1-ao-monthly
            product: product1-ao
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: product1-ao-monthly-evergreen
            auditLogs: []
        }]
        priceOverrides: null
        prices: [class PhasePrice {
            planName: product1-ao-monthly
            phaseName: product1-ao-monthly-trial
            phaseType: TRIAL
            fixedPrice: 0
            recurringPrice: null
            usagePrices: []
        }, class PhasePrice {
            planName: product1-ao-monthly
            phaseName: product1-ao-monthly-evergreen
            phaseType: EVERGREEN
            fixedPrice: null
            recurringPrice: 5
            usagePrices: []
        }]
        auditLogs: []
    }]
    timeline: class BundleTimeline {
        org.killbill.billing.client.model.gen.BundleTimeline@26b7a071
        accountId: 1d6ef148-3e91-455d-937a-27d8b2f6deff
        bundleId: 18cae774-d466-4a19-b1d3-d64fb6c0bd30
        externalKey: 18cae774-d466-4a19-b1d3-d64fb6c0bd30
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@d4de5a4
            eventId: 8a9c0292-a36d-4428-ac47-c9fe39876d5a
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: product1-ao-monthly
            product: product1-ao
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: product1-ao-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@6312065e
            eventId: 12c85188-f2a8-4590-83af-65c75fc9677b
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: product1-ao-monthly
            product: product1-ao
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: product1-ao-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@a057c269
            eventId: 6c87c127-edef-4762-9804-3cd8638673be
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: product1-ao-monthly
            product: product1-ao
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: product1-ao-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@535f32e2
            eventId: eadcaf35-673e-4d93-8adf-dfe5ad6422cb
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: product1-monthly
            product: Product1
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: product1-monthly-trial
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@d0d4bb9c
            eventId: 13495761-2cf0-46aa-ab80-7586cdaf8a11
            billingPeriod: MONTHLY
            effectiveDate: 2021-12-09
            plan: product1-ao-monthly
            product: product1-ao
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: product1-ao-monthly-evergreen
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@8351e73e
            eventId: 29a3ccee-f331-48d4-b1c6-be7f03d0d8c5
            billingPeriod: MONTHLY
            effectiveDate: 2021-12-09
            plan: product1-monthly
            product: Product1
            priceList: DEFAULT
            eventType: PHASE
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement+billing-service
            serviceStateName: PHASE
            phase: product1-monthly-evergreen
            auditLogs: []
        }]
        auditLogs: []
    }
    auditLogs: []
}, class Bundle {
    org.killbill.billing.client.model.gen.Bundle@2fedb607
    accountId: 1d6ef148-3e91-455d-937a-27d8b2f6deff
    bundleId: 64123897-ae99-452b-9dbd-88dd9f591bf4
    externalKey: 64123897-ae99-452b-9dbd-88dd9f591bf4
    subscriptions: [class Subscription {
        org.killbill.billing.client.model.gen.Subscription@39c20f59
        accountId: 1d6ef148-3e91-455d-937a-27d8b2f6deff
        bundleId: 64123897-ae99-452b-9dbd-88dd9f591bf4
        bundleExternalKey: 64123897-ae99-452b-9dbd-88dd9f591bf4
        subscriptionId: ccbb17ab-0734-49be-8a2a-ccc3fbe2ecdf
        externalKey: ccbb17ab-0734-49be-8a2a-ccc3fbe2ecdf
        startDate: 2021-11-29
        productName: Test
        productCategory: BASE
        billingPeriod: MONTHLY
        phaseType: EVERGREEN
        priceList: DEFAULT
        planName: test-monthly
        state: ACTIVE
        sourceType: NATIVE
        cancelledDate: null
        chargedThroughDate: 2021-12-29
        billingStartDate: 2021-11-29
        billingEndDate: null
        billCycleDayLocal: 29
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@1bb29bcf
            eventId: 133ae9b4-a250-4d93-8919-534a990ed4e4
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: test-monthly
            product: Test
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: test-monthly-evergreen
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@f46f814d
            eventId: 309cc4d6-c21e-4e01-8289-a5767e8272e8
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: test-monthly
            product: Test
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: test-monthly-evergreen
            auditLogs: []
        }]
        priceOverrides: null
        prices: [class PhasePrice {
            planName: test-monthly
            phaseName: test-monthly-evergreen
            phaseType: EVERGREEN
            fixedPrice: null
            recurringPrice: 20
            usagePrices: []
        }]
        auditLogs: []
    }, class Subscription {
        org.killbill.billing.client.model.gen.Subscription@c984106f
        accountId: 1d6ef148-3e91-455d-937a-27d8b2f6deff
        bundleId: 64123897-ae99-452b-9dbd-88dd9f591bf4
        bundleExternalKey: 64123897-ae99-452b-9dbd-88dd9f591bf4
        subscriptionId: 15e08a0d-9cce-4eb6-b3ce-ecd42e82ffa0
        externalKey: 15e08a0d-9cce-4eb6-b3ce-ecd42e82ffa0
        startDate: 2021-11-29
        productName: TestAO
        productCategory: ADD_ON
        billingPeriod: MONTHLY
        phaseType: EVERGREEN
        priceList: DEFAULT
        planName: testao-monthly
        state: ACTIVE
        sourceType: NATIVE
        cancelledDate: null
        chargedThroughDate: 2021-12-29
        billingStartDate: 2021-11-29
        billingEndDate: null
        billCycleDayLocal: 29
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@d1b77a46
            eventId: 02dcf5bd-a284-47ef-b88a-a5d8a67ba14c
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: testao-monthly
            product: TestAO
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: testao-monthly-evergreen
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@997747ea
            eventId: b724dc1a-e6bc-4a09-8790-f1d1d81bb8b5
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: testao-monthly
            product: TestAO
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: testao-monthly-evergreen
            auditLogs: []
        }]
        priceOverrides: null
        prices: [class PhasePrice {
            planName: testao-monthly
            phaseName: testao-monthly-evergreen
            phaseType: EVERGREEN
            fixedPrice: 100
            recurringPrice: 10
            usagePrices: []
        }]
        auditLogs: []
    }]
    timeline: class BundleTimeline {
        org.killbill.billing.client.model.gen.BundleTimeline@379f0209
        accountId: 1d6ef148-3e91-455d-937a-27d8b2f6deff
        bundleId: 64123897-ae99-452b-9dbd-88dd9f591bf4
        externalKey: 64123897-ae99-452b-9dbd-88dd9f591bf4
        events: [class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@7ebf20b
            eventId: 02dcf5bd-a284-47ef-b88a-a5d8a67ba14c
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: test-monthly
            product: Test
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: test-monthly-evergreen
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@d60a18b
            eventId: 133ae9b4-a250-4d93-8919-534a990ed4e4
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: test-monthly
            product: Test
            priceList: DEFAULT
            eventType: START_ENTITLEMENT
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: entitlement-service
            serviceStateName: ENT_STARTED
            phase: test-monthly-evergreen
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@c8e43ac8
            eventId: 309cc4d6-c21e-4e01-8289-a5767e8272e8
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: test-monthly
            product: Test
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: test-monthly-evergreen
            auditLogs: []
        }, class EventSubscription {
            org.killbill.billing.client.model.gen.EventSubscription@c00d61ad
            eventId: b724dc1a-e6bc-4a09-8790-f1d1d81bb8b5
            billingPeriod: MONTHLY
            effectiveDate: 2021-11-29
            plan: testao-monthly
            product: TestAO
            priceList: DEFAULT
            eventType: START_BILLING
            isBlockedBilling: false
            isBlockedEntitlement: false
            serviceName: billing-service
            serviceStateName: START_BILLING
            phase: testao-monthly-evergreen
            auditLogs: []
        }]
        auditLogs: []
    }
    auditLogs: []
}
```
```ruby
no content
```
```python
no content
```

**Request Body**

One or more subscription resource object corresponding to the base subscriptions need to be specified. Additional, each base subscription resource object can include zero or more subscription resource objects corresponding to add-on subscriptions. Alternatively, only a list of add-on subscription resource objects may be specified along with the base subscription bundle id. Each subscription resource object needs to include `accountId` and either the `planName` or a combination of `productName`, `productCategory`,`billingPeriod` and `priceList`.


In addition, each subscription resource can also include the following optional fields:

* `phaseType` - Target phase type. Specifying this field causes the subscription to start with this phase.
* `externalKey` - External key corresponding to the subscription.
* `billCycleDayLocal` - Per-subscription BCD. Specifying this value allows realigning the billing with the specified date. 
* `bundleId` - Id of the bundle in which to create this subscription. Can be specified only with an add-on subscription resource.


**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | ---- | -------- | ------- | ----------- |
| **entitlementDate** | string | no | immediately | Date at which the entitlement (sevice) starts in `yyyy-mm-dd` format. If specified, applies both to base and add-on products. |
| **billingDate** | string | no | immediately | Date at which the billing starts in `yyyy-mm-dd` format. If specified, applies both to base and add-on products. |
| **renameKeyIfExistsAndUnused** | boolean | no | true | If true, rename external key if it exists and is unused |
| **migrated** | boolean | no | false | If true, subscription is migrated |
| **callCompletion** | boolean | no | false | see below |
| **callTimeoutSec** | long | no | unlimited? | Timeout in seconds (see below) |

Creating a subscription often triggers the creation of an invoice, and associated with this there is often a payment (against the invoice). If **callCompletion** is true, the call to this API will be delayed until the invoice is created and/or the payment is processed. However, the maximum delay in seconds will be given by **callTimeoutSec**.

**Response**

If successful, returns a status code of 201 and an empty body. In addition, a `Location` parameter is returned in the header which contains the new subscription id.



### Retrieve a subscription by id

This API retrieves a subscription resource object based on its subscription id 

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}`

> Example Request:

```shell
curl \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/d4a919f4-7459-494f-85e5-af8880f63e90' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("905a0636-ab63-40c0-acd4-b461b6808b5d");

Subscription objFromJson = subscriptionApi.getSubscription(subscriptionId, 
                                                           AuditLevel.NONE, 
                                                           requestOptions);
```

```ruby
subscription_id = "161692a4-c293-410c-a92f-939c5e3dcba7"

KillBillClient::Model::Subscription.find_by_id(subscription_id, options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = '4aab9b96-c2e7-4641-a6d9-db984969201e'

subscriptionApi.get_subscription(subscription_id, api_key, api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json
<
{
    "accountId":"581d86fc-7cfc-46f2-b6d4-4dbc1d98beb3",
    "bundleId":"3b7a754c-4fe3-49a4-a56c-c8f56fc4116c",
    "subscriptionId":"d4a919f4-7459-494f-85e5-af8880f63e90",
    "externalKey":"somethingSpecial",
    "bundleExternalKey":"somethingAlsoSpecial",
    "startDate":"2018-07-19",
    "productName":"Super",
    "productCategory":"BASE",
    "billingPeriod":"MONTHLY",
    "phaseType":"TRIAL",
    "priceList":"DEFAULT",
    "planName":"super-monthly",
    "state":"ACTIVE",
    "sourceType":"NATIVE",
    "cancelledDate":null,
    "chargedThroughDate":"2018-07-19",
    "billingStartDate":"2018-07-19",
    "billingEndDate":null,
    "billCycleDayLocal":18,
    "events":
    [
        {"
            eventId":"d1fc7c9a-bdcd-447c-90f4-72c8de37d457",
            "billingPeriod":"MONTHLY",
            "effectiveDate":"2018-07-19",
            "plan":"super-monthly",
            "product":"Super",
            "priceList":"DEFAULT",
            "eventType":"START_ENTITLEMENT",
            "isBlockedBilling":false,
            "isBlockedEntitlement":false,
            "serviceName":"entitlement-service",
            "serviceStateName":"ENT_STARTED",
            "phase":"super-monthly-trial",
            "auditLogs":[]
        },
        {
            "eventId":"e1cea834-9c21-450a-8ff5-8e1ebef705d1",
            "billingPeriod":"MONTHLY",
            "effectiveDate":"2018-07-19",
            "plan":"super-monthly",
            "product":"Super",
            "priceList":"DEFAULT",
            "eventType":"START_BILLING",
            "isBlockedBilling":false,
            "isBlockedEntitlement":false,
            "serviceName":"billing-service",
            "serviceStateName":"START_BILLING",
            "phase":"super-monthly-trial",
            "auditLogs":[]
        },
        {
            "eventId":"c9045227-4638-46ca-9a4a-2d3086168505",
            "billingPeriod":"MONTHLY",
            "effectiveDate":"2018-08-18",
            "plan":"super-monthly",
            "product":"Super",
            "priceList":"DEFAULT",
            "eventType":"PHASE",
            "isBlockedBilling":false,
            "isBlockedEntitlement":false,
            "serviceName":"entitlement+billing-service",
            "serviceStateName":"PHASE",
            "phase":"super-monthly-evergreen",
            "auditLogs":[]
        }
    ],
    "priceOverrides":null,
    "prices":
    [
        {
            "planName":"super-monthly",
            "phaseName":"super-monthly-trial",
            "phaseType":"TRIAL",
            "fixedPrice":0,
            "recurringPrice":null,
            "usagePrices":[]
        },
        {
            "planName":"super-monthly",
            "phaseName":"super-monthly-evergreen",
            "phaseType":"EVERGREEN",
            "fixedPrice":null,
            "recurringPrice":1000.00,
            "usagePrices":[]
        }
    ],
    "auditLogs":[]}
```
            

```java
class Subscription {
    org.killbill.billing.client.model.gen.Subscription@c620bf78
    accountId: e903d1d6-7423-40fe-8ab7-d9d449484cda
    bundleId: 603db1e6-299e-4b8b-9dfc-beecccca39b2
    subscriptionId: b0f8f527-78c6-4fef-8fb2-53c9ed60a714
    externalKey: 99999
    bundleExternalKey: 88888
    startDate: 2012-04-25
    productName: Shotgun
    productCategory: BASE
    billingPeriod: ANNUAL
    phaseType: TRIAL
    priceList: DEFAULT
    planName: shotgun-annual
    state: ACTIVE
    sourceType: NATIVE
    cancelledDate: null
    chargedThroughDate: 2012-04-25
    billingStartDate: 2012-04-25
    billingEndDate: null
    billCycleDayLocal: 25
    events: [class EventSubscription {
        org.killbill.billing.client.model.gen.EventSubscription@c8078c46
        eventId: 7227bab2-b394-42de-b40c-97cecfd1d9ae
        billingPeriod: ANNUAL
        effectiveDate: 2012-04-25
        plan: shotgun-annual
        product: Shotgun
        priceList: DEFAULT
        eventType: START_ENTITLEMENT
        isBlockedBilling: false
        isBlockedEntitlement: false
        serviceName: entitlement-service
        serviceStateName: ENT_STARTED
        phase: shotgun-annual-trial
        auditLogs: []
    }, class EventSubscription {
        org.killbill.billing.client.model.gen.EventSubscription@1be0ca21
        eventId: ce8578e7-553f-45d7-a4d1-2abb7e625f64
        billingPeriod: ANNUAL
        effectiveDate: 2012-04-25
        plan: shotgun-annual
        product: Shotgun
        priceList: DEFAULT
        eventType: START_BILLING
        isBlockedBilling: false
        isBlockedEntitlement: false
        serviceName: billing-service
        serviceStateName: START_BILLING
        phase: shotgun-annual-trial
        auditLogs: []
    }, class EventSubscription {
        org.killbill.billing.client.model.gen.EventSubscription@f0472744
        eventId: 26d5ea05-b91d-43e6-8aa2-ac0ac82f6a95
        billingPeriod: ANNUAL
        effectiveDate: 2012-05-25
        plan: shotgun-annual
        product: Shotgun
        priceList: DEFAULT
        eventType: PHASE
        isBlockedBilling: false
        isBlockedEntitlement: false
        serviceName: entitlement+billing-service
        serviceStateName: PHASE
        phase: shotgun-annual-evergreen
        auditLogs: []
    }]
    priceOverrides: null
    prices: [class PhasePrice {
        planName: shotgun-annual
        phaseName: shotgun-annual-trial
        phaseType: TRIAL
        fixedPrice: 0
        recurringPrice: null
        usagePrices: []
    }, class PhasePrice {
        planName: shotgun-annual
        phaseName: shotgun-annual-evergreen
        phaseType: EVERGREEN
        fixedPrice: null
        recurringPrice: 249.95
        usagePrices: []
    }]
    auditLogs: []
}
```
```ruby
{
   "accountId":"0cdaeca7-4984-47dc-b245-7c32627f26cd",
   "bundleId":"d1f4ca8d-be47-4e64-84ce-f697b42d4182",
   "subscriptionId":"161692a4-c293-410c-a92f-939c5e3dcba7",
   "externalKey":"d1f4ca8d-be47-4e64-84ce-f697b42d4182",
   "bundleExternalKey":"a4f4ca8d-3447-4e64-84ce-6697b42d419c",
   "startDate":"2013-08-01",
   "productName":"Basic",
   "productCategory":"BASE",
   "billingPeriod":"MONTHLY",
   "phaseType":"EVERGREEN",
   "priceList":"DEFAULT",
   "planName":"basic-monthly-in-advance",
   "state":"ACTIVE",
   "sourceType":"NATIVE",
   "chargedThroughDate":"2013-09-01",
   "billingStartDate":"2013-08-01",
   "billCycleDayLocal":1,
   "events":[
      {
         "eventId":"dda11bf3-f74a-4c42-83e1-0f43a41389af",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-01",
         "plan":"basic-monthly-in-advance",
         "product":"Basic",
         "priceList":"DEFAULT",
         "eventType":"START_ENTITLEMENT",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"entitlement-service",
         "serviceStateName":"ENT_STARTED",
         "phase":"basic-monthly-in-advance-evergreen",
         "auditLogs":[]
      },
      {
         "eventId":"6901117c-4ce0-4eb6-8642-380823490fae",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-01",
         "plan":"basic-monthly-in-advance",
         "product":"Basic",
         "priceList":"DEFAULT",
         "eventType":"START_BILLING",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"billing-service",
         "serviceStateName":"START_BILLING",
         "phase":"basic-monthly-in-advance-evergreen",
         "auditLogs":[]
      }
   ],
   "prices":[
      {
         "planName":"basic-monthly-in-advance",
         "phaseName":"asic-monthly-in-advance-trial",
         "phaseType":"TRIAL",
         "fixedPrice":0,
         "recurringPrice":null,
         "usagePrices":[]
      },
      {
         "planName":"basic-monthly-in-advance",
         "phaseName":"basic-monthly-in-advance-evergreen",
         "phaseType":"EVERGREEN",
         "fixedPrice":null,
         "recurringPrice":500.0,
         "usagePrices":[]
      }
   ],
   "auditLogs":[]
}
```
```python
{'account_id': '3b1a5a67-f0ac-475c-9aad-735d309f0c1f',
 'audit_logs': [],
 'bill_cycle_day_local': 13,
 'billing_end_date': None,
 'billing_period': 'MONTHLY',
 'billing_start_date': datetime.date(2018, 5, 14),
 'bundle_id': 'e5590623-ccd4-4a8a-be26-008ce7c02b3b',
 'cancelled_date': None,
 'charged_through_date': None,
 'events': [{'audit_logs': [],
             'billing_period': 'MONTHLY',
             'effective_date': datetime.date(2018, 5, 14),
             'event_id': '46335d3d-8234-49c3-af1a-dcf8cd354ef3',
             'event_type': 'START_ENTITLEMENT',
             'is_blocked_billing': False,
             'is_blocked_entitlement': False,
             'phase': 'standard-monthly-trial',
             'plan': 'standard-monthly',
             'price_list': 'DEFAULT',
             'product': 'Standard',
             'service_name': 'entitlement-service',
             'service_state_name': 'ENT_STARTED'},
            {'audit_logs': [],
             'billing_period': 'MONTHLY',
             'effective_date': datetime.date(2018, 5, 14),
             'event_id': 'a14d6512-7479-46e0-b72b-81dff575d1d4',
             'event_type': 'START_BILLING',
             'is_blocked_billing': False,
             'is_blocked_entitlement': False,
             'phase': 'standard-monthly-trial',
             'plan': 'standard-monthly',
             'price_list': 'DEFAULT',
             'product': 'Standard',
             'service_name': 'billing-service',
             'service_state_name': 'START_BILLING'},
            {'audit_logs': [],
             'billing_period': 'MONTHLY',
             'effective_date': datetime.date(2018, 6, 13),
             'event_id': '27408c65-46b8-4bc9-a7ee-c80d6e5fb9b5',
             'event_type': 'PHASE',
             'is_blocked_billing': False,
             'is_blocked_entitlement': False,
             'phase': 'standard-monthly-evergreen',
             'plan': 'standard-monthly',
             'price_list': 'DEFAULT',
             'product': 'Standard',
             'service_name': 'entitlement+billing-service',
             'service_state_name': 'PHASE'}],
 'external_key': 'e5590623-ccd4-4a8a-be26-008ce7c02b3b',
 'phase_type': 'TRIAL',
 'plan_name': 'standard-monthly',
 'price_list': 'DEFAULT',
 'prices': [{'fixed_price': 0.0,
              'phase_name': 'standard-monthly-trial',
              'phase_type': 'TRIAL',
              'plan_name': 'standard-monthly',
              'recurring_price': None,
              'usage_prices': []},
             {'fixed_price': None,
              'phase_name': 'standard-monthly-evergreen',
              'phase_type': 'EVERGREEN',
              'plan_name': 'standard-monthly',
              'recurring_price': 100.0,
              'usage_prices': []}],  
 'product_category': 'BASE',
 'product_name': 'Standard',
 'source_type': 'NATIVE',
 'start_date': datetime.date(2018, 5, 14),
 'state': 'ACTIVE',
 'subscription_id': '4aab9b96-c2e7-4641-a6d9-db984969201e'}
```
**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- |
| **audit** | string | no | "NONE" | Level of audit information to return |

Audit information options are "NONE", "MINIMAL" (only inserts), or "FULL".

**Response**

If successful, returns a status code of 200 and a subscription resource object.


### Retrieve a subscription by key

This API retrieves a subscription resource object based on its external key 

**HTTP Request**

`GET http://127.0.0.1:8080/1.0/kb/subscriptions/`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    'http://localhost:8080/1.0/kb/subscriptions?externalKey=somethingSpecial'
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

String externalKey = "somethingSpecial";
Subscription objFromJson = subscriptionApi.getSubscriptionByKey(externalKey, requestOptions);
```

```ruby
external_key = "somethingSpecial"
KillBillClient::Model::Subscription.find_by_external_key(external_key, options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
external_key = 'somethingSpecial'
subscriptionApi.get_subscription_by_key(external_key, api_key, api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json
<
{
  "accountId": "1f979085-1765-471b-878a-5f640db4d831",
  "bundleId": "8815e8c0-afab-41b9-b793-cb8fef2382e4",
  "bundleExternalKey": "8815e8c0-afab-41b9-b793-cb8fef2382e4",
  "subscriptionId": "8e5c5339-1cad-46c6-ab18-3d5ddc1b2414",
  "externalKey": "somethingSpecial",
  "startDate": "2020-01-08",
  "productName": "Pistol",
  "productCategory": "BASE",
  "billingPeriod": "MONTHLY",
  "phaseType": "EVERGREEN",
  "priceList": "notrial",
  "planName": "pistol-monthly-notrial",
  "state": "ACTIVE",
  "sourceType": "NATIVE",
  "cancelledDate": null,
  "chargedThroughDate": "2020-05-08",
  "billingStartDate": "2020-01-08",
  "billingEndDate": null,
  "billCycleDayLocal": 8,
  "events": [
    {
      "eventId": "1d24928e-790d-4dc9-8a88-c4eaa56de392",
      "billingPeriod": "MONTHLY",
      "effectiveDate": "2020-01-08",
      "plan": "pistol-monthly-notrial",
      "product": "Pistol",
      "priceList": "notrial",
      "eventType": "START_ENTITLEMENT",
      "isBlockedBilling": false,
      "isBlockedEntitlement": false,
      "serviceName": "entitlement-service",
      "serviceStateName": "ENT_STARTED",
      "phase": "pistol-monthly-notrial-evergreen",
      "auditLogs": []
    },
    {
      "eventId": "3aaa3239-2bc6-4f04-977b-fce5de098af8",
      "billingPeriod": "MONTHLY",
      "effectiveDate": "2020-01-08",
      "plan": "pistol-monthly-notrial",
      "product": "Pistol",
      "priceList": "notrial",
      "eventType": "START_BILLING",
      "isBlockedBilling": false,
      "isBlockedEntitlement": false,
      "serviceName": "billing-service",
      "serviceStateName": "START_BILLING",
      "phase": "pistol-monthly-notrial-evergreen",
      "auditLogs": []
    }
  ],
  "priceOverrides": null,
  "prices": [
    {
      "planName": "pistol-monthly-notrial",
      "phaseName": "pistol-monthly-notrial-evergreen",
      "phaseType": "EVERGREEN",
      "fixedPrice": null,
      "recurringPrice": 19.95,
      "usagePrices": []
    }
  ],
  "auditLogs": []
}
```
```ruby
{
   "accountId":"0cdaeca7-4984-47dc-b245-7c32627f26cd",
   "bundleId":"d1f4ca8d-be47-4e64-84ce-f697b42d4182",
   "subscriptionId":"161692a4-c293-410c-a92f-939c5e3dcba7",
   "externalKey":"somethingSpecial",
   "bundleExternalKey":"a4f4ca8d-3447-4e64-84ce-6697b42d419c",
   "startDate":"2013-08-01",
   "productName":"Basic",
   "productCategory":"BASE",
   "billingPeriod":"MONTHLY",
   "phaseType":"EVERGREEN",
   "priceList":"DEFAULT",
   "planName":"basic-monthly-in-advance",
   "state":"ACTIVE",
   "sourceType":"NATIVE",
   "chargedThroughDate":"2013-09-01",
   "billingStartDate":"2013-08-01",
   "billCycleDayLocal":1,
   "events":[
      {
         "eventId":"dda11bf3-f74a-4c42-83e1-0f43a41389af",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-01",
         "plan":"basic-monthly-in-advance",
         "product":"Basic",
         "priceList":"DEFAULT",
         "eventType":"START_ENTITLEMENT",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"entitlement-service",
         "serviceStateName":"ENT_STARTED",
         "phase":"basic-monthly-in-advance-evergreen",
         "auditLogs":[]
      },
      {
         "eventId":"6901117c-4ce0-4eb6-8642-380823490fae",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-01",
         "plan":"basic-monthly-in-advance",
         "product":"Basic",
         "priceList":"DEFAULT",
         "eventType":"START_BILLING",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"billing-service",
         "serviceStateName":"START_BILLING",
         "phase":"basic-monthly-in-advance-evergreen",
         "auditLogs":[]
      }
   ],
   "prices":[
      {
         "planName":"basic-monthly-in-advance",
         "phaseName":"asic-monthly-in-advance-trial",
         "phaseType":"TRIAL",
         "fixedPrice":0,
         "recurringPrice":null,
         "usagePrices":[]
      },
      {
         "planName":"basic-monthly-in-advance",
         "phaseName":"basic-monthly-in-advance-evergreen",
         "phaseType":"EVERGREEN",
         "fixedPrice":null,
         "recurringPrice":500.0,
         "usagePrices":[]
      }
   ],
   "auditLogs":[]
}
```
```python
{'account_id': '3b1a5a67-f0ac-475c-9aad-735d309f0c1f',
 'audit_logs': [],
 'bill_cycle_day_local': 13,
 'billing_end_date': None,
 'billing_period': 'MONTHLY',
 'billing_start_date': datetime.date(2018, 5, 14),
 'bundle_id': 'e5590623-ccd4-4a8a-be26-008ce7c02b3b',
 'cancelled_date': None,
 'charged_through_date': None,
 'events': [{'audit_logs': [],
             'billing_period': 'MONTHLY',
             'effective_date': datetime.date(2018, 5, 14),
             'event_id': '46335d3d-8234-49c3-af1a-dcf8cd354ef3',
             'event_type': 'START_ENTITLEMENT',
             'is_blocked_billing': False,
             'is_blocked_entitlement': False,
             'phase': 'standard-monthly-trial',
             'plan': 'standard-monthly',
             'price_list': 'DEFAULT',
             'product': 'Standard',
             'service_name': 'entitlement-service',
             'service_state_name': 'ENT_STARTED'},
            {'audit_logs': [],
             'billing_period': 'MONTHLY',
             'effective_date': datetime.date(2018, 5, 14),
             'event_id': 'a14d6512-7479-46e0-b72b-81dff575d1d4',
             'event_type': 'START_BILLING',
             'is_blocked_billing': False,
             'is_blocked_entitlement': False,
             'phase': 'standard-monthly-trial',
             'plan': 'standard-monthly',
             'price_list': 'DEFAULT',
             'product': 'Standard',
             'service_name': 'billing-service',
             'service_state_name': 'START_BILLING'},
            {'audit_logs': [],
             'billing_period': 'MONTHLY',
             'effective_date': datetime.date(2018, 6, 13),
             'event_id': '27408c65-46b8-4bc9-a7ee-c80d6e5fb9b5',
             'event_type': 'PHASE',
             'is_blocked_billing': False,
             'is_blocked_entitlement': False,
             'phase': 'standard-monthly-evergreen',
             'plan': 'standard-monthly',
             'price_list': 'DEFAULT',
             'product': 'Standard',
             'service_name': 'entitlement+billing-service',
             'service_state_name': 'PHASE'}],
 'external_key': 'somethingSpecial',
 'phase_type': 'TRIAL',
 'plan_name': 'standard-monthly',
 'price_list': 'DEFAULT',
 'prices': [{'fixed_price': 0.0,
              'phase_name': 'standard-monthly-trial',
              'phase_type': 'TRIAL',
              'plan_name': 'standard-monthly',
              'recurring_price': None,
              'usage_prices': []},
             {'fixed_price': None,
              'phase_name': 'standard-monthly-evergreen',
              'phase_type': 'EVERGREEN',
              'plan_name': 'standard-monthly',
              'recurring_price': 100.0,
              'usage_prices': []}],
 'product_category': 'BASE',
 'product_name': 'Standard',
 'source_type': 'NATIVE',
 'start_date': datetime.date(2018, 5, 14),
 'state': 'ACTIVE',
 'subscription_id': '4aab9b96-c2e7-4641-a6d9-db984969201e'}
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- |
| **externalKey** | String | yes | none | The subscription external key |
| **audit** | string | no | "NONE" | Level of audit information to return |

Audit information options are "NONE", "MINIMAL" (only inserts), or "FULL".

**Response**

If successful, returns a status code of 200 and a subscription resource object.


### Update the BCD associated with a subscription

This API allows you to change the Bill Cycle Date, BCD, for a given subscription.
This only applies to subscriptions whose recurring term is month based -- e.g `MONTHLY`, `ANNUAL`, ... 

For example if a given subscription was invoiced on the 1st, then one could use this API
to realign invoicing, let's say on the 16th. 

**HTTP Request** 

`PUT http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/bcd`

> Example Request:

```shell
curl -v \
    -X PUT \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '{ "billCycleDayLocal": 16 }' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/bcd' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("905a0636-ab63-40c0-acd4-b461b6808b5d");

Subscription updatedSubscription = new Subscription();
updatedSubscription.setSubscriptionId(subscriptionId);
updatedSubscription.setBillCycleDayLocal(9);

LocalDate effectiveFromDate = null;

subscriptionApi.updateSubscriptionBCD(subscriptionId, 
                                      updatedSubscription, 
                                      effectiveFromDate, 
                                      requestOptions);
```

```ruby
subscription                      = KillBillClient::Model::Subscription.new
subscription.subscription_id      = "161692a4-c293-410c-a92f-939c5e3dcba7"
subscription.bill_cycle_day_local = 16

effective_from_date  = '2018-08-16'
force_past_effective_date = nil

subscription.update_bcd(user, 
                        reason, 
                        comment, 
                        effective_from_date, 
                        force_past_effective_date, 
                        options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = '161692a4-c293-410c-a92f-939c5e3dcba7'
body = Subscription(subscription_id=subscription_id,
                    bill_cycle_day_local=26)

subscriptionApi.update_subscription_bcd(subscription_id,
                                        body,
                                        created_by,
                                        api_key,
                                        api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```
```ruby
no content
```
```python
no content
```

**Request Body**

The new BCD needs to be specified in the request body via the `billCycleDayLocal` field.

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | ---- | -------- | ------- |  ----------- |
| **effectiveFromDate** | string | no | immediate | Date on which this change becomes effective in `yyyy-mm-dd` format. | 
| **forceNewBcdWithPastEffectiveDate** | boolean | no | false | See below | 

By default the effective date must be in the future so as to not modify existing invoices. Setting **forceNewBcdWithPastEffectiveDate** to true allows the date to be set in the past. 

Secondly, even after this endpoint is executed, the [Retrieve a Subscription](https://killbill.github.io/slate/?shell#subscription-retrieve-a-subscription-by-id) endpoint will still return the old BCD until an invoice is generated on the new BCD.


**Response**

If successful, returns a status code of 204 and an empty body.

### Update the subscription quantity

This API allows you to change the subscription quantity.


**HTTP Request** 

`PUT http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/quantity`

> Example Request:

```shell
curl -v \
    -X PUT \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '{ 
            "quantity": "2" 
        }' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/c20715fa-8d69-488d-a094-51da0cdf999b/quantity'
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("f0143401-5b9b-41d1-b9c0-8513f1f0cf0b");

Subscription body = new Subscription();
body.setQuantity(3);
LocalDate effectiveFromDate = null;
		
subscriptionApi.updateSubscriptionQuantity(subscriptionId, body, effectiveFromDate, requestOptions);
```

```ruby
TODO
```

```python
TODO
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```
```ruby
no content
```
```python
no content
```

**Request Body**

The quantity needs to be specified in the request body via the `quantity` field.

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | ---- | -------- | ------- |  ----------- |
| **effectiveFromDate** | string | no | immediate | Date on which this change becomes effective in `yyyy-mm-dd` format. | 
| **forceNewQuantityWithPastEffectiveDate** | boolean | no | false | See below | 

By default the effective date must be in the future so as to not modify existing invoices. Setting **forceNewQuantityWithPastEffectiveDate** to true allows the date to be set in the past. 


**Response**

If successful, returns a status code of 204 and an empty body.


### Change subscription plan


This API allows you to upgrade or downgrade a given subscription to a new `Plan`.

**HTTP Request** 

`PUT http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}`

> Example Request:

```shell
curl -v \
    -X PUT \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '{ 
            "productName": "Sports", 
            "billingPeriod": "MONTHLY", 
            "priceList": "DEFAULT"
        }' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712'
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("905a0636-ab63-40c0-acd4-b461b6808b5d");

Subscription newInput = new Subscription();
newInput.setSubscriptionId(subscriptionId);

// Specify the product, billing period and price list
newInput.setProductName("Shotgun");
newInput.setBillingPeriod(BillingPeriod.MONTHLY);
newInput.setPriceList("DEFAULT");

// Alternatively, you can specify the plan name
newInput.setPlanName("shotgun-monthly");

LocalDate requestedDate = null;
Map<String, String> NULL_PLUGIN_PROPERTIES = null;

//specify either requestedDate or BillingActionPolicy
subscriptionApi.changeSubscriptionPlan(subscriptionId, 
                                       newInput, 
                                       requestedDate, 
                                       BillingActionPolicy.IMMEDIATE, 
                                       NULL_PLUGIN_PROPERTIES, 
                                       requestOptions);
```

```ruby
input = {
           :productName => 'Super', 
           :billingPeriod => 'MONTHLY', 
           :priceList => 'DEFAULT'
         }
         
requested_date = nil
billing_policy = nil
call_completion = false
target_phase_type = nil

subscription.change_plan(input, 
                         user, 
                         reason, 
                         comment, 
                         requested_date, 
                         billing_policy,
                         target_phase_type, 
                         call_completion, 
                         options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = '97278000-72fd-45d7-9b67-e44690bdb074'
body = Subscription(product_name='Super',
                    billing_period='MONTHLY',
                    price_list='DEFAULT')

subscriptionApi.change_subscription_plan(subscription_id,
                                         body,
                                         created_by,
                                         api_key,
                                         api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```
```ruby
{
   "accountId":"986c5d4e-b322-4d71-ad24-e3bf6e38734a",
   "bundleId":"b0b9da5f-6844-417b-ac97-d7e8df07c26a",
   "subscriptionId":"97278000-72fd-45d7-9b67-e44690bdb074",
   "externalKey":"986c5d4e-b322-4d71-ad24-e3bf6e38734a-452347",
   "bundleExternalKey":"765c5d4e-b322-4d71-6544-e3bf6e38734a-cd2347",
   "startDate":"2013-08-01",
   "productName":"Super",
   "productCategory":"BASE",
   "billingPeriod":"MONTHLY",
   "phaseType":"TRIAL",
   "priceList":"DEFAULT",
   "planName":"super-monthly",
   "state":"ACTIVE",
   "sourceType":"NATIVE",
   "chargedThroughDate":"2013-08-01",
   "billingStartDate":"2013-08-01",
   "billCycleDayLocal":31,
   "events":[
      {
         "eventId":"b2c4195a-0888-44e4-91a7-537b20b08bd8",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-01",
         "plan":"sports-monthly",
         "product":"Sports",
         "priceList":"DEFAULT",
         "eventType":"START_ENTITLEMENT",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"entitlement-service",
         "serviceStateName":"ENT_STARTED",
         "phase":"sports-monthly-trial",
         "auditLogs":[]
      },
      {
         "eventId":"0c15d9ba-f0f3-40e6-83d7-2d84af703d06",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-01",
         "plan":"sports-monthly",
         "product":"Sports",
         "priceList":"DEFAULT",
         "eventType":"START_BILLING",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"billing-service",
         "serviceStateName":"START_BILLING",
         "phase":"sports-monthly-trial",
         "auditLogs":[]
      },
      {
         "eventId":"b675c39f-eeef-4cc1-8ffc-e50f51e8a84a",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-02",
         "plan":"super-monthly",
         "product":"Super",
         "priceList":"DEFAULT",
         "eventType":"CHANGE",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"entitlement+billing-service",
         "serviceStateName":"CHANGE",
         "phase":"super-monthly-trial",
         "auditLogs":[]
      },
      {
         "eventId":"e411fe3e-6d38-4256-bd96-867f3a50c634",
         "billingPeriod":"MONTHLY",
         "effectiveDate":"2013-08-31",
         "plan":"super-monthly",
         "product":"Super",
         "priceList":"DEFAULT",
         "eventType":"PHASE",
         "isBlockedBilling":false,
         "isBlockedEntitlement":false,
         "serviceName":"entitlement+billing-service",
         "serviceStateName":"PHASE",
         "phase":"super-monthly-evergreen",
         "auditLogs":[]
      }
   ],
   "prices":[
      {
         "planName":"sports-monthly",
         "phaseName":"sports-monthly-trial",
         "phaseType":"TRIAL",
         "fixedPrice":0,
         "recurringPrice":null,
         "usagePrices":[]
      },
      {
         "planName":"sports-monthly",
         "phaseName":"sports-monthly-evergreen",
         "phaseType":"EVERGREEN",
         "fixedPrice":null,
         "recurringPrice":500.0,
         "usagePrices":[]
      }
   ],
   "auditLogs":[]
}
```
```python
no content
```
**Request Body**

A subscription resource object specifying either the `planName` or a combination of `productName`, `billingPeriod` and `priceList`. 

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | ---- | -------- | ------- | ----------- |
| **billingPolicy** | string | no | default | Billing policy that will be used to make this change effective (see below) |
| **requestedDate** | string | no | immediate | Date/DateTime at which this change should become effective in `yyyy-mm-dd`/`yyyy-mm-ddThh:mm`  format.|
| **callCompletion** | boolean | no | false | see below |
| **callTimeoutSec** | long | no | unlimited? | Timeout in seconds (see below) |

**billingPolicy**: Possible values are START_OF_TERM, END_OF_TERM, IMMEDIATE, or ILLEGAL

**requestedDate**: This date is only used if no billingPolicy was specified.

Changing the plan associated to a subscription often triggers the creation of an invoice, and associated with this there is often a payment (against the invoice). If **callCompletion** is true, the call to this API will be delayed until the invoice is created and/or the payment is processed. However, the maximum delay in seconds will be given by **callTimeoutSec**.

**Response**

If successful, returns a status code of 204 and an empty body.


### Undo a pending change plan on a subscription

This endpoint allows a pending `Plan` change (plan change request with a future effective date) for a given subscription to be canceled. Note that if the plan change is already effective, then it cannot be undone. 

**HTTP Request** 

`PUT http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/undoChangePlan`

> Example Request:

```shell
curl \
    -X PUT \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/undoChangePlan' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("1bb4b638-3886-4f73-90a5-89eb6d1bcf7f");
Map<String, String> NULL_PLUGIN_PROPERTIES = null;

subscriptionApi.undoChangeSubscriptionPlan(subscriptionId, 
                                           NULL_PLUGIN_PROPERTIES, 
                                           requestOptions);
```

```ruby
subscription.undo_change_plan(user, 
                              reason, 
                              comment, 
                              options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = 'f5bb14ed-c6e8-4895-8d4e-34422e12cdfa'

subscriptionApi.undo_change_subscription_plan(subscription_id,
                                              created_by,
                                              api_key,
                                              api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

None. 

**Response**

If successful, returns a status code of 204 and an empty body.



### Cancel a subscription

This API cancels an existing subscription.

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}`

> Example Request:

```shell
curl  -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712'
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("905a0636-ab63-40c0-acd4-b461b6808b5d");
LocalDate requestedDate = null;
EntitlementActionPolicy entitlementPolicy = null;
BillingActionPolicy billingPolicy = null;
Map<String, String> NULL_PLUGIN_PROPERTIES = null;

subscriptionApi.cancelSubscriptionPlan(subscriptionId,
                                       requestedDate, 
                                       entitlementPolicy, 
                                       billingPolicy, 
                                       NULL_PLUGIN_PROPERTIES, 
                                       requestOptions);
```

```ruby
requested_date = nil
entitlement_policy = nil
billing_policy = nil
use_requested_date_for_billing = nil

subscription.cancel(user, 
                    reason, 
                    comment, 
                    requested_date, 
                    entitlement_policy, 
                    billing_policy, 
                    use_requested_date_for_billing, 
                    options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = 'ee508b5b-46b8-42a7-8988-16c0470de4ae'

subscriptionApi.cancel_subscription_plan(subscription_id, 
                                         created_by,
                                         api_key,
                                         api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | ---- | -------- | ------- | ----------- |
| **requestedDate** | string | no | immediate | Date/DateTime at which this change should become effective in `yyyy-mm-dd`/`yyyy-mm-ddThh:mm`  format.|
| **entitlementPolicy** | string | no | IMMEDIATE | entitlement policy (see below) |
| **billingPolicy** | string | no | default policy from catalog if present, otherwise `END_OF_TERM` | billing policy (see below) |
| **useRequestedDateForBilling** | boolean | no | false | use **requestedDate** for billing |
| **callCompletion** | boolean | no | false | see below |
| **callTimeoutSec** | long | no | unlimited? | Timeout in seconds (see below) |


**entitlementPolicy**: Possible values are IMMEDIATE, END_OF_TERM

**billingPolicy**: Possible values are START_OF_TERM, END_OF_TERM, or IMMEDIATE

Creating a subscription often triggers the creation of an invoice, and associated with this there is often a payment (against the invoice). If **callCompletion** is true, the call to this API will be delayed until the invoice is created and/or the payment is processed. However, the maximum delay in seconds will be given by **callTimeoutSec**.




Since we offer the ability to control the cancelation date for both entitlement (service) and billing either through policies, dates or null values (now), it is important to understand how those parameters work:

* If `entitlementPolicy` has been defined, the `requestedDate` is ignored, and we either default to the catalog defined `billingPolicy` for this `Plan`, or use the one provided in this API.
* If not, the `requestedDate` is used to compute the entitlement cancelation date, and the null value means change should be immediate. The billing date will then be computed the following way:
  * If `billingPolicy` has been specified, it is used to compute the billing cancelation date
  * If `billingPolicy` has not been specified, we either use the `requestedDate` when `useRequestedDateForBilling` is true or default to the catalog defined `billingPolicy` for this `Plan`

So, the common use case would require the following:

* **Immediate cancelation**: This will create a prorated credit unless this aligns with the subscription charged through date (`CTD`), that is, the date up to which it was invoiced, and then from an entitlement point of view it will deactivate service immediately. In order to achieve this result, one can pass the following parameters: `entitlementPolicy`=`IMMEDIATE` and `billingPolicy`=`IMMEDIATE`; alternatively passing no parameters and therefore a null `requestedDate` would produce the same result.
* **EOT cancelation**: This will not create any proration and will keep the service active until the end of the period (`CTD`). In order to achieve this result, one can pass the following parameters: `entitlementPolicy`=`END_OF_TERM` and `billingPolicy`=`END_OF_TERM`.

The reason for all this complexity is to allow to control entitlement and billing date separately, and also avoid users to have to compute dates to achieve certain behavior by relying on well defined policies.

**Other Notes:**
* If a subscription is created with a future date and if the cancel method is invoked for immediate cancellation, the cancellation takes effect only after the subscription creation date is reached. Thus, the subscription remains in `PENDING` state until the subscription creation date is reached after which it is moved to the `CANCELLED` state.

**Returns**

If successful, returns a status code of 204 and an empty body.


### Un-cancel a subscription

This endpoint allows you to undo a pending cancellation (cancellation request with a future effective date) for a given subscription.


**HTTP Request** 

`PUT http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/uncancel`

> Example Request:

```shell
curl \
    -X PUT \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/uncancel' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("1bb4b638-3886-4f73-90a5-89eb6d1bcf7f");
Map<String, String> NULL_PLUGIN_PROPERTIES = null;

subscriptionApi.uncancelSubscriptionPlan(subscriptionId, 
                                         NULL_PLUGIN_PROPERTIES, 
                                         requestOptions);
```

```ruby
subscription.uncancel(user, 
                      reason, 
                      comment, 
                      options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = 'f5bb14ed-c6e8-4895-8d4e-34422e12cdfa'

subscriptionApi.uncancel_subscription_plan(subscription_id,
                                           created_by,
                                           api_key,
                                           api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

None. 

**Returns**

If successful, returns a status code of 204 and an empty body.


## Blocking State

See section [Account Blocking State](#account-blocking-state) for an introduction to blocking states.

### Block a subscription

Provides a low level interface to add a `BlockingState` event for this subscription. 

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/block`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '{ 
            "stateName": "STATE",
            "service": "ServiceStateService",
            "isBlockChange": false,
            "isBlockEntitlement": false,
            "isBlockBilling": false
    }' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/block' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("161692a4-c293-410c-a92f-939c5e3dcba7");

BlockingState blockingState = new BlockingState();
blockingState.setStateName("STATE1");
blockingState.setService("ServiceStateService");
blockingState.setIsBlockChange(false);
blockingState.setIsBlockBilling(false);
blockingState.setIsBlockEntitlement(false);

LocalDate requestedDate = new LocalDate("2013-08-01");
Map<String, String> pluginProperty = Collections.emptyMap();

BlockingStates result = subscriptionApi.addSubscriptionBlockingState(subscriptionId,
                                                                     blockingState,
                                                                     requestedDate,
                                                                     pluginProperty,
                                                                     requestOptions);
```

```ruby
subscription = KillBillClient::Model::Subscription.new
subscription.subscription_id = "161692a4-c293-410c-a92f-939c5e3dcba7"

state_name = 'STATE1'
service = 'ServiceStateService'
block_change = false
block_entitlement = false
block_billing = false
requested_date = nil

subscription.set_blocking_state(state_name, 
                                service, 
                                block_change, 
                                block_entitlement, 
                                block_billing, 
                                requested_date, 
                                user, 
                                reason,
                                comment, 
                                options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
body = BlockingState(state_name='STATE1',
                     service='ServiceStateService',
                     is_block_change=False,
                     is_block_entitlement=False,
                     is_block_billing=False)

subscriptionApi.add_subscription_blocking_state(subscription_id,
                                                body,
                                                created_by,
                                                api_key,
                                                api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Location: http://127.0.0.1:8080/1.0/kb/accounts/581d86fc-7cfc-46f2-b6d4-4dbc1d98beb3/block?blockingStateTypes=SUBSCRIPTION
< Content-Length: 0
```
```java
[class BlockingState {
    org.killbill.billing.client.model.gen.BlockingState@bf898dea
    blockedId: 161692a4-c293-410c-a92f-939c5e3dcba7
    stateName: ENT_STARTED
    service: entitlement-service
    isBlockChange: false
    isBlockEntitlement: false
    isBlockBilling: false
    effectiveDate: 2012-04-25T00:03:42.000Z
    type: SUBSCRIPTION
    auditLogs: []
}, class BlockingState {
    org.killbill.billing.client.model.gen.BlockingState@fd3732d8
    blockedId: 161692a4-c293-410c-a92f-939c5e3dcba7
    stateName: STATE1
    service: ServiceStateService
    isBlockChange: false
    isBlockEntitlement: false
    isBlockBilling: false
    effectiveDate: 2013-08-01T00:03:42.000Z
    type: SUBSCRIPTION
    auditLogs: []
}]
```
```ruby
no content
```
```python
no content
```

**Request Body**

A blocking state resource representing the intended new blocking state. For example,

```
{
  "blockedId": "943c4fd0-9000-4975-a3a8-09712223e1f8",
  "stateName": "STATE1",
  "service": "ServiceStateService",
  "isBlockChange": false,
  "isBlockEntitlement": false,
  "isBlockBilling": true,
  "effectiveDate": "2020-07-18T18:22:30.376Z",
  "type": "SUBSCRIPTION"
}
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | ---- | -------- | ------- | ----------- |
| **requestedDate** | string | no | immediate | Date/DateTime to begin blocking in `yyyy-mm-dd`/`yyyy-mm-ddThh:mm` format. | 

**Response**

If successful, returns a status code of 201 and an empty body.


## Custom Fields

`Custom fields` are `{key, value}` attributes that can be attached to any customer resources. For more on custom fields see [Custom Fields](#custom-fields). These endpoints manage custom fields associated with `Subscription` objects.

### Add custom fields to subscription

Adds one or more custom fields to a subscription object. Existing custom fields are not disturbed.

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/customFields`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '[{ 
            "objectId": "77e23878-8b9d-403b-bf31-93003e125712",
            "objectType": "SUBSCRIPTION",
            "name": "Test Custom Field",
            "value": "test_value"
    }]' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/customFields' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("cca08349-8b26-41c7-bfcc-2e3cf70a0f28");

final List<AuditLog> EMPTY_AUDIT_LOGS = Collections.emptyList();

CustomFields customFields = new CustomFields();
customFields.add(new CustomField(null, 
                                 subscriptionId, 
                                 ObjectType.SUBSCRIPTION, 
                                 "Test Custom Field", 
                                 "test_value", 
                                 EMPTY_AUDIT_LOGS));

subscriptionApi.createSubscriptionCustomFields(subscriptionId, 
                                               customFields, 
                                               requestOptions);
```

```ruby
custom_field = KillBillClient::Model::CustomFieldAttributes.new
custom_field.object_type = 'SUBSCRIPTION'
custom_field.name = 'Test Custom Field'
custom_field.value = 'test_value'

subscription.add_custom_field(custom_field, 
                              user,
                              reason,
                              comment,
                              options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = '4927c1a2-3959-4f71-98e7-ce3ba19c92ac'
body = CustomField(name='Test Custom Field', value='test_value')

subscriptionApi.create_subscription_custom_fields(subscription_id,
                                                  [body],
                                                  created_by,
                                                  api_key,
                                                  api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/customFields
< Content-Type: application/json
< Content-Length: 0
```

```java
//First element of the list
class CustomField {
    org.killbill.billing.client.model.gen.CustomField@c7d0c38a
    customFieldId: null
    objectId: cca08349-8b26-41c7-bfcc-2e3cf70a0f28
    objectType: SUBSCRIPTION
    name: Test Custom Field
    value: test_value
    auditLogs: []
}
```
```ruby
[
   {
      "customFieldId":"7fb3dde7-0911-4477-99e3-69d142509bb9",
      "objectId":"4927c1a2-3959-4f71-98e7-ce3ba19c92ac",
      "objectType":"SUBSCRIPTION",
      "name":"Test Custom Field",
      "value":"test_value",
      "auditLogs":[]
   }
]
```

```python
no content
```

**Request Body**

A list of objects giving the name and value of the custom field, or fields, to be added. For example:

    [
      {
        "name": "CF1",
        "value": "123"
      }
    ]


**Query Parameters**

None.

**Response**

If successful, returns a 201 status code.In addition, a Location header is returned giving the URL to retrieve the custom fields associated with the subscription.

### Retrieve subscription custom fields

Returns any custom field objects associated with the specified subscription

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/customFields`

> Example Request:

```shell
curl \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/customFields' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("cca08349-8b26-41c7-bfcc-2e3cf70a0f28");

List<CustomField> customFields = subscriptionApi.getSubscriptionCustomFields(subscriptionId,
                                                                             AuditLevel.NONE,
                                                                             requestOptions);
```

```ruby
audit = 'NONE'

subscription.custom_fields(audit, options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = '642ee0ac-972b-4cdf-b9ae-ab8f9bb9bc05'

subscriptionApi.get_subscription_custom_fields(subscription_id,
                                               api_key,
                                               api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 Ok
< Content-Type: application/json
<
[
    {
        "customFieldId":"439ed0f8-9b37-4688-bace-e2595b1d3801",
        "objectId":"77e23878-8b9d-403b-bf31-93003e125712",
        "objectType":"SUBSCRIPTION",
        "name":"Test Custom Field",
        "value":"test_value",
        "auditLogs":[]
    }
]
```

```java
//First element of the list
class CustomField {
    org.killbill.billing.client.model.gen.CustomField@c7d0c38a
    customFieldId: null
    objectId: cca08349-8b26-41c7-bfcc-2e3cf70a0f28
    objectType: SUBSCRIPTION
    name: Test Custom Field
    value: test_value
    auditLogs: []
}
```
```ruby
[
   {
      "customFieldId":"7fb3dde7-0911-4477-99e3-69d142509bb9",
      "objectId":"4927c1a2-3959-4f71-98e7-ce3ba19c92ac",
      "objectType":"SUBSCRIPTION",
      "name":"Test Custom Field",
      "value":"test_value",
      "auditLogs":[]
   }
]
```

```python
[{'audit_logs': [],
 'custom_field_id': '31a21da4-1eae-4f83-b9e4-49c53217d33e',
 'name': 'Test Custom Field',
 'object_id': '642ee0ac-972b-4cdf-b9ae-ab8f9bb9bc05',
 'object_type': 'SUBSCRIPTION',
 'value': 'test_value'}]
```


**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- | 
| **audit** | string | no | "NONE" | Level of audit information to return:"NONE", "MINIMAL", or "FULL" |

**Response**

If successful, returns a status code of 200 and a (possibly empty) list of custom field objects.

### Modify custom fields for a subscription

Modifies the value of one or more existing custom fields associated with a subscription. Note that it is not possible to modify the name of a custom field, it is only possible to modify its value.

**HTTP Request** 

`PUT http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/customFields`

> Example Request:

```shell
curl -v \
    -X PUT \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '[{ 
            "customFieldId": "439ed0f8-9b37-4688-bace-e2595b1d3801",
            "value": "NewValue"
    }]' \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/customFields' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("cca08349-8b26-41c7-bfcc-2e3cf70a0f28");
UUID customFieldsId = UUID.fromString("9913e0f6-b5ef-498b-ac47-60e1626eba8f");

CustomField customFieldModified = new CustomField();
customFieldModified.setCustomFieldId(customFieldsId);
customFieldModified.setValue("NewValue");
CustomFields customFields = new CustomFields();
customFields.add(customFieldModified);

subscriptionApi.modifySubscriptionCustomFields(subscriptionId, 
                                               customFields, 
                                               requestOptions);
```

```ruby
custom_field.custom_field_id = '7fb3dde7-0911-4477-99e3-69d142509bb9'
custom_field.name = 'Test Modify'
custom_field.value = 'test_modify_value'

subscription.modify_custom_field(custom_field,                                                                                            
                                 user, 
                                 reason,
                                 comment, 
                                 options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = '4927c1a2-3959-4f71-98e7-ce3ba19c92ac'
custom_field_id = '7fb3dde7-0911-4477-99e3-69d142509bb9'
body = CustomField(custom_field_id=custom_field_id, 
                   name='Test Custom Field', 
                   value='test_value')

subscriptionApi.modify_subscription_custom_fields(subscription_id,
                                                  [body],
                                                  created_by,
                                                  api_key,
                                                  api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```

```ruby
no content
```

```python
no content
```
**Request Body**

A list of objects specifying the id and the new value for the custom fields to be modified. For example:

[ { "customFieldId": "6d4c073b-fd89-4e39-9802-eba65f42492f", "value": "123" } ]

Although the `fieldName` and `objectType` can be specified in the request body, these cannot be modified, only the field value can be modified.

**Query Parameters**

None.

**Response**

If successful, returns a status code of 204 and an empty body.

### Remove custom fields from subscription

Delete one or more custom fields from a subscription


**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/customFields`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/customFields?customField=439ed0f8-9b37-4688-bace-e2595b1d3801' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("cca08349-8b26-41c7-bfcc-2e3cf70a0f28");
UUID customFieldsId = UUID.fromString("9913e0f6-b5ef-498b-ac47-60e1626eba8f");
List<UUID> customFieldsList = List.of(customFieldsId);

subscriptionApi.deleteSubscriptionCustomFields(subscriptionId, 
                                               customFieldsList, 
                                               requestOptions);
```

```ruby
custom_field_id = custom_field.id

subscription.remove_custom_field(custom_field_id,                                                                                            
                                 user, 
                                 reason,
                                 comment, 
                                 options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = '4927c1a2-3959-4f71-98e7-ce3ba19c92ac'

subscriptionApi.delete_subscription_custom_fields(subscription_id,
                                                  created_by,
                                                  api_key,
                                                  api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```
```ruby
no content
```
```python
no content
```


**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- | 
| **customField** | string | yes | none | Custom field object ID that should be deleted. Multiple custom fields can be deleted by specifying a separate **customField** parameter corresponding to each field |

**Response**

If successful, returns a status code of 204 and an empty body.

## Tags


See section [Account Tags](#account-tags) for an introduction.

The are no `system` tags applicable for a `Subscription`.

### Add tags to subscription

This API adds one or more tags to a subscription. The tag definitions must already exist.

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/tags`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -d '[
            "353752dd-9041-4450-b782-a8bb03a923c8"
        ]' \
  'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/tags' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("1bb4b638-3886-4f73-90a5-89eb6d1bcf7f");
UUID tagDefinitionId = UUID.fromString("353752dd-9041-4450-b782-a8bb03a923c8");

subscriptionApi.createSubscriptionTags(subscriptionId, 
                                                     List.of(tagDefinitionId), 
                                                     requestOptions);
```

```ruby
tag_name = 'foo'

subscription.add_tag(tag_name,
                     user,
                     reason,
                     comment,
                     options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = '28af3cb9-275b-4ac4-a55d-a0536e479069'
tag = ["353752dd-9041-4450-b782-a8bb03a923c8"]

subscriptionApi.create_subscription_tags(subscription_id,
                                         tag,
                                         created_by,
                                         api_key,
                                         api_secret)
```
> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 201 Created
< Location: http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/tags
< Content-Type: application/json
< Content-Length: 0
```

```java
//First element of the list
class Tag {
    org.killbill.billing.client.model.gen.Tag@bd138472
    tagId: 1bb4b638-3886-4f73-90a5-89eb6d1bcf7f
    objectType: SUBSCRIPTION
    objectId: 917992d3-5f1f-4828-9fff-799cc4211aa9
    tagDefinitionId: 353752dd-9041-4450-b782-a8bb03a923c8
    tagDefinitionName: foo
    auditLogs: []
}
```
```ruby
[
   {
      "tagId":"a46cfeb6-e175-42db-be62-7f117326ab4e",
      "objectType":"SUBSCRIPTION",
      "objectId":"28af3cb9-275b-4ac4-a55d-a0536e479069",
      "tagDefinitionId":"353752dd-9041-4450-b782-a8bb03a923c8",
      "tagDefinitionName":"foo",
      "auditLogs":[]
   }
]
```
```python
no content
```

**Request Body**

A JSON array containing one or more strings giving the UUID of tag definitions for the user tags to be added.

**Query Parameters**

None.

**Returns**

If successful, returns a 201 status code. In addition, a Location header is returned giving the URL to retrieve the tags associated with the subscription.


### Retrieve subscription tags

Retrieve all tags attached to this subscription.


**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/tags`

> Example Request:

```shell
curl \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/tags' 
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("1bb4b638-3886-4f73-90a5-89eb6d1bcf7f");

Boolean includedDeleted = false; // Will not include deleted tags

List<Tag> tags = subscriptionApi.getSubscriptionTags(subscriptionId, 
                                                     includedDeleted, 
                                                     AuditLevel.FULL, 
                                                     requestOptions);
```

```ruby
included_deleted = false
audit = 'NONE'

subscription.tags(included_deleted,
                  audit,
                  options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = 'f5bb14ed-c6e8-4895-8d4e-34422e12cdfa'

subscriptionApi.get_subscription_tags(subscription_id,
                                      api_key,
                                      api_secret)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
<
[
    {
        "tagId":"d0513754-56a9-4694-abb1-3ac46c72e861",
        "objectType":"SUBSCRIPTION",
        "objectId":"77e23878-8b9d-403b-bf31-93003e125712",
        "tagDefinitionId":"353752dd-9041-4450-b782-a8bb03a923c8",
        "tagDefinitionName":"foo",
        "auditLogs":[]
    }
]
```

```java
//First element of the list
class Tag {
    org.killbill.billing.client.model.gen.Tag@bd138472
    tagId: 1bb4b638-3886-4f73-90a5-89eb6d1bcf7f
    objectType: SUBSCRIPTION
    objectId: 917992d3-5f1f-4828-9fff-799cc4211aa9
    tagDefinitionId: 353752dd-9041-4450-b782-a8bb03a923c8
    tagDefinitionName: foo
    auditLogs: []
}
```
```ruby
[
   {
      "tagId":"a46cfeb6-e175-42db-be62-7f117326ab4e",
      "objectType":"SUBSCRIPTION",
      "objectId":"28af3cb9-275b-4ac4-a55d-a0536e479069",
      "tagDefinitionId":"353752dd-9041-4450-b782-a8bb03a923c8",
      "tagDefinitionName":"foo",
      "auditLogs":[]
   }
]
```
```python
[{'audit_logs': [],
 'object_id': 'f5bb14ed-c6e8-4895-8d4e-34422e12cdfa',
 'object_type': 'SUBSCRIPTION',
 'tag_definition_id': '353752dd-9041-4450-b782-a8bb03a923c8',
 'tag_definition_name': 'foo',
 'tag_id': 'a1fd0122-1ec8-4bc3-b71e-ab2a76ae5957'}]
```

**Query Parameters**


| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- |
| **includedDeleted** | boolean | no | false | If true, include deleted tags |
| **audit** | string | no | "NONE" | Level of audit information to return: "NONE", "MINIMAL", or "FULL" |


**Response**
    
If successful, returns a status code of 200 and a list of tag objects.

### Remove tags from subscription

This API removes a list of tags attached to a subscription.

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/tags`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "X-Killbill-CreatedBy: demo" \
    'http://127.0.0.1:8080/1.0/kb/subscriptions/77e23878-8b9d-403b-bf31-93003e125712/tags?tagDef=353752dd-9041-4450-b782-a8bb03a923c8' 	
```

```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("1bb4b638-3886-4f73-90a5-89eb6d1bcf7f");

UUID tagDefinitionId = UUID.fromString("353752dd-9041-4450-b782-a8bb03a923c8");

subscriptionApi.deleteSubscriptionTags(subscriptionId, 
                                       List.of(tagDefinitionId), 
                                       requestOptions);
```

```ruby
tag_name = 'foo'

subscription.remove_tag(tag_name,
                        user,
                        reason,
                        comment,
                        options)
```

```python
subscriptionApi = killbill.api.SubscriptionApi()
subscription_id = 'f5bb14ed-c6e8-4895-8d4e-34422e12cdfa'
tag = ["353752dd-9041-4450-b782-a8bb03a923c8"]

subscriptionApi.delete_subscription_tags(subscription_id,
                                         created_by,
                                         api_key,
                                         api_secret,
                                         tag_def=tag)
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 204 No Content
< Content-Type: application/json
< Content-Length: 0
```

```java
no content
```
```ruby
no content
```
```python
no content
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ------------ |
| **tagDef** | array of strings | true | none | A tag definition ID identifying the tag that should be removed. Multiple tags can be deleted by specifying a separate tagDef parameter corresponding to each tag. |

**Response**

If successful, returns a status code of 204 and an empty body.


## Audit Logs

Audit logs provide a record of events that occur involving various specific resources. For details on audit logs see [Audit and History](https://killbill.github.io/slate/#using-kill-bill-apis-audit-and-history).


### Retrieve subscription audit logs with history by subscription id

Retrieve a list of audit log records showing events that occurred involving changes to the subscription. History information is included with each record.


**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/subscriptions/{subscriptionId}/auditLogsWithHistory`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://localhost:8080/1.0/kb/subscriptions/70b6856e-6938-495f-9ae9-0a8ec0571c37/auditLogsWithHistory"
```
```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionId = UUID.fromString("bc9b98e8-7497-4330-aa42-1fbc71a3d19c");
		
List<AuditLog> auditLog = subscriptionApi.getSubscriptionAuditLogsWithHistory(subscriptionId, 																				  																							requestOptions);
```

> Example Response:

```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

[
  {
    "changeType": "INSERT",
    "changeDate": "2019-02-22T22:38:10.000Z",
    "objectType": "SUBSCRIPTION",
    "objectId": "70b6856e-6938-495f-9ae9-0a8ec0571c37",
    "changedBy": "admin",
    "reasonCode": null,
    "comments": null,
    "userToken": "1f03e074-dea1-45c5-aee3-c9464886f476",
    "history": {
      "id": null,
      "createdDate": "2019-02-22T22:38:10.000Z",
      "updatedDate": "2019-02-22T22:38:10.000Z",
      "recordId": 465,
      "accountRecordId": 10,
      "tenantRecordId": 1,
      "bundleId": "d1b329c7-7dcf-466c-aaca-47bff304dab0",
      "category": "BASE",
      "startDate": "2019-02-22T22:38:10.000Z",
      "bundleStartDate": "2019-02-22T22:38:10.000Z",
      "chargedThroughDate": null,
      "migrated": false,
      "tableName": "SUBSCRIPTIONS",
      "historyTableName": "SUBSCRIPTION_HISTORY"
    }
  },
  {
    "changeType": "UPDATE",
    "changeDate": "2019-02-22T22:38:10.000Z",
    "objectType": "SUBSCRIPTION",
    "objectId": "70b6856e-6938-495f-9ae9-0a8ec0571c37",
    "changedBy": "SubscriptionBaseTransition",
    "reasonCode": null,
    "comments": null,
    "userToken": "1f03e074-dea1-45c5-aee3-c9464886f476",
    "history": {
      "id": null,
      "createdDate": "2019-02-22T22:38:10.000Z",
      "updatedDate": "2019-02-22T22:38:10.000Z",
      "recordId": 465,
      "accountRecordId": 10,
      "tenantRecordId": 1,
      "bundleId": "d1b329c7-7dcf-466c-aaca-47bff304dab0",
      "category": "BASE",
      "startDate": "2019-02-22T22:38:10.000Z",
      "bundleStartDate": "2019-02-22T22:38:10.000Z",
      "chargedThroughDate": "2019-03-22T23:35:14.000Z",
      "migrated": false,
      "tableName": "SUBSCRIPTIONS",
      "historyTableName": "SUBSCRIPTION_HISTORY"
    }
  }
]

```

**Query Parameters**

None.

**Response**
    
If successful, returns a status code of 200 and a list of audit logs.



### Retrieve subscription event audit logs with history by subscription event id

Retrieve a list of audit log records showing events that occurred involving changes to the subscription, based on a subscription event id. History information (a copy of the full subscription object) is included with each record. The id of a subscription event comes from the [timeline api](#account-retrieve-account-timeline).

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/subscriptions/events/{subscriptionEventId}/auditLogsWithHistory`



> Example Request:

```shell
curl  \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://localhost:8080/1.0/kb/subscriptions/events/9a1c85d5-beba-40c8-9268-f73e09c24007/auditLogsWithHistory"
```
```java
import org.killbill.billing.client.api.gen.SubscriptionApi;
protected SubscriptionApi subscriptionApi;

UUID subscriptionEventId = UUID.fromString("b4b6f990-4456-4009-9e6c-9825a99a1f25");
		
List<AuditLog> eventAuditLog = subscriptionApi.getSubscriptionEventAuditLogsWithHistory(subscriptionEventId, requestOptions);
```

> Example Response:


```shell
# Subset of headers returned when specifying -v curl option
< HTTP/1.1 200 OK
< Content-Type: application/json

[
  {
    "changeType": "INSERT",
    "changeDate": "2019-02-22T22:38:10.000Z",
    "objectType": "SUBSCRIPTION_EVENT",
    "objectId": "9a1c85d5-beba-40c8-9268-f73e09c24007",
    "changedBy": "admin",
    "reasonCode": null,
    "comments": null,
    "userToken": "1f03e074-dea1-45c5-aee3-c9464886f476",
    "history": {
      "id": null,
      "createdDate": "2019-02-22T22:38:10.000Z",
      "updatedDate": "2019-02-22T22:38:10.000Z",
      "recordId": 1358,
      "accountRecordId": 10,
      "tenantRecordId": 1,
      "totalOrdering": 0,
      "eventType": "API_USER",
      "userType": "CREATE",
      "effectiveDate": "2019-02-22T22:38:10.000Z",
      "subscriptionId": "70b6856e-6938-495f-9ae9-0a8ec0571c37",
      "planName": "foo-monthly",
      "phaseName": "foo-monthly-evergreen",
      "priceListName": "DEFAULT",
      "billingCycleDayLocal": 0,
      "isActive": true,
      "tableName": "SUBSCRIPTION_EVENTS",
      "historyTableName": "SUBSCRIPTION_EVENT_HISTORY",
      "active": true
    }
  }
]
```
**Query Parameters**

None.

**Response**
    
If successful, returns a status code of 200 and a list of audit logs with history.

